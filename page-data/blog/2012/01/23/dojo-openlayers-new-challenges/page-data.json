{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2012/01/23/dojo-openlayers-new-challenges","webpackCompilationHash":"642efac6ed852a3b544d","result":{"data":{"markdownRemark":{"html":"<p>Recently, the new Dojo 1.7 was released with many improvements and important changes.\nAs a developer, I'm pleased to work with Dojo on RIA application because simple reasons:</p>\n<ul>\n<li>It offers almost all I need: module organization, an extensive set of widgets to create interfaces, manipulation of DOM elements, AJAX communications, etc.</li>\n<li>It is relatively easy to use and learn. Here I found the declarative way to work really useful because helps developers and designers work together but on different things.</li>\n<li>Creating custom widgets, after some relatively easy learning curve, brings you more power and flexibility.</li>\n</ul>\n<p>Yes, Dojo is a great project, but as I mentioned at the beginning I like it for RIA projects, that is, for big or complex CRUD applications. For small things, like nice web pages, I prefer jQuery plus some plugins.</p>\n<p>Looking at the new features of Dojo 1.7 I found a new module dojox.geo.openlayers which acts as a wrapper around OpenLayers GIS library and extends with some Dojo capabilities.</p>\n<p>Now, add Dojo GFX shapes or Dojo widgets on top OpenLayers is possible, opining new possibilities. With this merge we can do things like add pie charts to our maps to show to statistics information. It is awesome !!!</p>\n<p style=\"text-align: center;\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 425px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAClklEQVQozxWS24oUVxSG693yAHmBXAm5TK6E4IWIFzFoIkKISHCiCWgGkgxqN5kwxFHDnOxu+zA9U9V12se1z7tqV9UEJ7fZc7fW4l+s7/9ZyauD2eh4/upo9tdyrYAEAwpoK6G3ykraaN5bqRDpnQyGa4stZQqhlzu/3bhxOxnPF6Ppcnex+nOxwqSOC8EIi6nDWFMmKmQFc5I5ihpGNEOSVY1hRwf7n3x6LSkIPs02p+l6kqXrzZkTtDfiolG94Z1kXgMw0gXlFYs4QXNrieFcCkJIncSmMQR0OTQ0aBEJW849ZUFCQ6klhGPkNR1a1QDrnZC0ZrjGRR00JL4Bpet8sxr9k23KCEkHJ6NocPBxcBEYUHGhwaLollgNWjBveAQMgiVDMF7Vt+58d/PxdO+kApxJIIxXzgrLq9f777Z20VlasLLSnLurRLgW+HCyJhQlzrFh0C/H4/s/7izTqKgsMAfEaxmz+fKrb+7+Mo1KL7AH1lrwAm39/PzedvriXZFoR9og/+us1dhxainuO/1vIy4b2nl1dHj4+/htXdeDVV5Qp0n08uCHrdvf/7E9WiStBy9Z3HGGDV42SihaHb2fjQ9KXOaXrbrsLEo3VZ47gRXDmtPgVb4pdAwMoVKxunOC0xxY1Tt9Ppt8fv3bh2M+X1WdA4PLJ0+37+/gk1lqWR0Ua6R08upnkvX5Oeb5ZPL60fO/f30jiuw8Th8+frY9OsjyjcC1BXL95r27P+1PVyhCGaBX94GSGiUvZvNZka6mh5998fWzveIsy/oGGiOcZsFyWZQWI4by99MloLI1EKzovTRKkLJMdpene/NlWqSL+ez4+INAOS5SnGUBuCe44aSNBfD4IR870xm4CKZ10hsxWPgfwLGUzDB8o00AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"openlayers dojo\" title=\"openlayers dojo\" src=\"/static/9adb67f4fd90bcc9d098d14b2e8799c5/a67b6/openlayers_dojo.png\" srcset=\"/static/9adb67f4fd90bcc9d098d14b2e8799c5/19bd1/openlayers_dojo.png 163w,\n/static/9adb67f4fd90bcc9d098d14b2e8799c5/d3bcb/openlayers_dojo.png 325w,\n/static/9adb67f4fd90bcc9d098d14b2e8799c5/a67b6/openlayers_dojo.png 425w\" sizes=\"(max-width: 425px) 100vw, 425px\" loading=\"lazy\">\n    </span></p>\n<h2>A very short introdutcion to <em>dojox.geo.openlayers</em> package</h2>\n<p>Before making a little demo playing with all this new things, we need a short description.</p>\n<p>The main class in the package is <em>dojox.geo.openlayers.Map</em> which acts as a kind of wrapper around the <em>OpenLayers.Map</em> class. You can access at any time to the OpenLayers underline object with the <em>getOLMap()</em> method.</p>\n<p>Next, there is the <em>dojox.geo.openlayers.Layer</em> class which is a wrapper around the <em>OpenLayers.Layer</em> class. It allows to attach to the map any Dojo element.</p>\n<p>The <em>dojox.geo.openlayers.GfxLayer</em> is a subclass of the previous class specially designed to work with GFX shapes and render them on top of OpenLayers map.</p>\n<p>The <em>dojox.geo.openlayers.Feature</em> class represents the features we can attach to a <em>dojox.geo.openlayers.Layer</em>. The subclass <em>dojox.geo.openlayers.GeometryFeature</em> is designed to render LineString, Points and Collections of geometries.</p>\n<blockquote><p>Because GeometryFeature works with <em>dojox.gfx</em> package to render the geometries you need to add it always to a<em> dojox.geo.openlayers.GfxLayer</em> layer.</p></blockquote>\n<h2>Hands on code</h2>\n<p>We are going to create a map with three features:</p>\n<ul>\n<li>a <em>dojox.gfx</em> shape feature, with an animation attached to it to change it fill color,</li>\n<li>a pie chart and</li>\n<li>a stacked area chart.</li>\n</ul>\n<p>You can see the demo in action <a href=\"http://www.acuriousanimal.com/dojo-openlayers/\">http://www.acuriousanimal.com/dojo-openlayers/</a>, (source code at <a href=\"https://github.com/acanimal/dojo-openlayers\">GitHub</a>) and it should looks something like:</p>\n<p><a href=\"http://www.acuriousanimal.com/dojo-openlayers/\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 450px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 69.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACuklEQVQoz02RW08TQRzF+aImfgt9NF6iiUER2m6BUmOUiGwrhRZ6sdAqUi6Fmdnd2ft2Z2dmL91ui2JifHWsmJich0kmv5z/OWdhHyGhOoBfDX2c8oFp7AHQgFCog9AhUrHr/JjGQ8M4APDE0E3fnSV8ErFvk3jhL7wHYFdV05Rd2EYdKR1dP9C0gWN7lA4NK4hYV9ebikZ9P+M8C/ksCWdJ9AduINTHmmJbyLZcOnrbauW3tgqyXKpUavXGu0p1fVsuyfLHdickLHSCcUAnURizYOHvzT4nNPDbV8Bh9mb1w/2nzx4uvnix9KqwkpfyhaIkreXze5XKdRyPKY8CmnI24Wx+NkS67w0M48LSWeTJu/KDxcWXS/lSce11qVReL73ZKJfX1mvVyjQOsyjM4lA8plF4m3keG3zB6oVjlbbeL71clpaLhZy0Wiiu5qViLi+t5A52d28yUQsXvHAe3zrPJertIqSYTrW6I+UKwkpaKZQ3Nl5vlOs7O2efT4jupAET8B/bJEzZf7BQByKPjFr1em55ZV1arcm1c8Uj4XR8/TOd/Zx+/5WEyYRRAY+DYML5LdyYqwZAD+Nuq91sNJRLOGbRp3OvdWLH2c3hmb1/bGbZJEvYNOEBIccavp2qhZS+onWg0kdqQkWekPpByPlmL7rzdPjknXavcHb38SHAwfWYJYyemubOFZhPhWAfaREJKCGB64syILa3B2oP658RlY/s1ind7pnykeV5fMZYFLAmQG1FmcMQ9jUtDqnruiEjOvGev9l99NbsKe6lg7u6ao4c1bds4oic57ppe57jeZSMFg7ESBCeYpxGLE04C8iRilf32rnq8T7UW+J3CI6A+gkpws33fPEAlnWTRt8m/3ZuInRlWrY3EjU0ITrVMLBM1bKG2OgA5auKxZDiwAHWD5Ei5I48QslvIkmXjuUZu8YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sc01 dojo openlayers1\" title=\"sc01_dojo_openlayers\" src=\"/static/a0123b777dc94c42b24429fecbfcfc7d/44727/sc01_dojo_openlayers1.png\" srcset=\"/static/a0123b777dc94c42b24429fecbfcfc7d/19bd1/sc01_dojo_openlayers1.png 163w,\n/static/a0123b777dc94c42b24429fecbfcfc7d/d3bcb/sc01_dojo_openlayers1.png 325w,\n/static/a0123b777dc94c42b24429fecbfcfc7d/44727/sc01_dojo_openlayers1.png 450w\" sizes=\"(max-width: 450px) 100vw, 450px\" loading=\"lazy\">\n    </span></a></p>\n<p>Lets go. Start creating new HTML page and paste the next code, which correspond to the skeleton of our demo:</p>\n<pre class=\"brush:js\">&lt;!DOCTYPE HTML&gt;\n&lt;html&gt;\n    &lt;head&gt;\n\t\t&lt;title&gt;Dojo + OpenLayers = New Challenge&lt;/title&gt;\n        &lt;style&gt;\n            html, body {\n                width: 100%;\n                height: 100%;\n            }\n        &lt;/style&gt;\n        &lt;script type=\"text/javascript\" src=\"https://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojo/dojo.js\"&gt;&lt;/script&gt;\n        &lt;link rel=\"stylesheet\" href=\"https://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dijit/themes/claro/claro.css\"/&gt;\n        &lt;link rel=\"stylesheet\" href=\"https://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dijit/themes/claro/document.css\"/&gt;\n        &lt;script type=\"text/javascript\" src=\"http://openlayers.org/api/2.10/OpenLayers.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            require([\n                \"dojo/ready\",\n                \"dojo/parser\",\n                \"dojo/dom-construct\",\n                \"dojox/geo/openlayers/Map\",\n                \"dojox/geo/openlayers/GfxLayer\",\n                \"dojox/geo/openlayers/GeometryFeature\",\n                \"dojox/geo/openlayers/WidgetFeature\",\n                \"dojox/gfx/fx\",\n                \"dojox/charting/widget/Chart2D\",\n                \"dojox/charting/themes/PlotKit/blue\"\n            ], function(ready) {\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">            ready(function(){\n                console.log(dojo.version.major + &quot;.&quot; + dojo.version.minor + &quot;.&quot; + dojo.version.patch);\n\n\t\t\t\t// Here put the magic !!!\n            })\n        });\n    &amp;lt;/script&amp;gt;\n&amp;lt;/head&amp;gt;\n\n&amp;lt;body class=&quot;claro&quot;&amp;gt;\n    &amp;lt;div id=&quot;map&quot; style=&quot;width: 100%; height: 100%;&quot;&amp;gt;&amp;lt;/div&amp;gt;\n&amp;lt;/body&amp;gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>&#x3C;/html></pre></p>\n<p>I'm using Dojo 1.7 and the new way to work using <em>require</em>. As you can see I'm referencing the modules my code requires from <em>dojo</em> and <em>dojox</em> packages</p>\n<p>Once Dojo is loaded the ready is executed showing the Dojo version in the console and executing the code shown next, which really creates the map and the features.</p>\n<p>In the \"here put the magic\" section we can place the code that creates a new <em>dojox.geo.openlayers.Map</em> instance:</p>\n<pre class=\"brush:js\">//\n// Define some Map options.\n//\n// openLayersMapOptions: Options for the underlaying OpenLayers.Map instance\n// baseLayerName: Name of the base layer for the map\n// baseLayerType: Type of the base layer. See 'dojox.geo.openlayers.BaseLayerType'\n// baseLayerUrl: Necessary, for example, for WMS.\n// accessible: Adds a OpenLayers.Control.KeyboardDefaults control to the map\n//     to move it using keyboard.\n// touchHandler: Touch support for the map.\n//\nvar options = {\n    baseLayerName : \"OSM\",\n    baseLayerType : dojox.geo.openlayers.BaseLayerType.OSM,\n    touchHandler : true,\n    accessible : true\n};\n<p>// Create a map instance\nvar map = new dojox.geo.openlayers.Map('map');\nmap.fitTo([-10,30,40,62]);</pre></p>\n<p>Next create a GFX layer. On it we can attach geometry features or any other Dojo widget feature.</p>\n<blockquote><p>Remember you only can attach geometry features to a GFX layer.</p></blockquote>\n<pre class=\"brush:js\">// Create a GFX layer\nvar gfxLayer = new dojox.geo.openlayers.GfxLayer();\nmap.addLayer(gfxLayer);</pre>\n<p>Now create a geometry feature, defined by a LineString with some points, and add it to the layer:</p>\n<pre class=\"brush:js\">// Create a geometry feature\nvar line = new dojox.geo.openlayers.LineString([{x:0, y:45},{x:0, y:55},{x:20, y:55},{x:20, y:50},{x:0, y:45}]);\nvar feature = new dojox.geo.openlayers.GeometryFeature(line);\nfeature.setStroke({color: \"#666\", width: 2});\nfeature.setFill(\"#999\");\n<p>// Add to the GFX layer\ngfxLayer.addFeature(feature);\ngfxLayer.redraw();</pre></p>\n<p>We want to animate the fill color of the geometry feature so we need to create a couple of animation. The first one will change the fill color from the original color to transparent, while the second will change from transparent to the original color again.</p>\n<p>The trick is once the first animation ends we start the second animation (using the '<em>onEnd</em>' method) and the same for the second animation. This way we create an infinite animation effect.</p>\n<pre class=\"brush:js\">// Add an animation to change the color of the feature\nvar animA = dojox.gfx.fx.animateFill({\n    shape : feature,\n    duration : 700,\n    color : {\n        start: \"#999\",\n        end: \"transparent\"\n    },\n    onAnimate: function() {\n        // Required to update the layer while feature change it fill color\n        gfxLayer.redraw();\n    },\n    onEnd: function() {\n        animB.play();\n    }\n});\nvar animB = dojox.gfx.fx.animateFill({\n    shape : feature,\n    duration : 700,\n    color : {\n        start: \"transparent\",\n        end: \"#999\"\n    },\n    onAnimate: function() {\n        // Required to update the layer while feature change it fill color\n        gfxLayer.redraw();\n    },\n    onEnd: function() {\n        animA.play();\n    }\n});\nanimA.play();</pre>\n<p>Now, we are going to create a pie chart widget feature. We are going to use the <em>dojox.geo.openlayers.WidgetFeature</em> class which required an object in the constructor defining the widget to create, the lat/lon where to place the widget and some more parameters. You can find all the available parameters in the source code documentation:</p>\n<pre class=\"brush:js\">//\t* _createWidget_: Function for widget creation. Must return a `dijit._Widget`.\n//\t* _dojoType_: The class of a widget to create;\n//\t* _dijitId_: The digitId of an existing widget.\n//\t* _widget_: An already created widget.\n//\t* _width_: The width of the widget.\n//\t* _height_: The height of the widget.\n//\t* _longitude_: The longitude, in decimal degrees where to place the widget.\n//\t* _latitude_: The latitude, in decimal degrees where to place the widget.</pre>\n<p>The pie chart widget have a 100x100 size and will we located at (lon,lat)=(5, 40). The <em>createWidget</em> property must point to a function responsible to create the appropriate widget:</p>\n<pre class=\"brush:js\">// Add a widget feature\nvar chartSize1 = 100;\nvar co1 = [5,40];\nvar descr1 = {\n    // location of the widget\n    longitude : co1[0],\n    latitude : co1[1],\n    // the function which creates the widget\n    createWidget : function(){\n        var div = dojo.create(\"div\", {}, dojo.body());\n        var chart = new dojox.charting.widget.Chart({\n            margins : {\n                l : 0,\n                r : 0,\n                t : 0,\n                b : 0\n            }\n        }, div);\n        var c = chart.chart;\n        c.addPlot(\"default\", {\n            type : \"Pie\",\n            radius : chartSize1 / 2,\n            labelOffset : chartSize1,\n            fontColor : \"black\"\n        });\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    var ser = [2, 8, 12, 43, 56, 23, 43, 1, 33];\n    c.addSeries(&quot;Series&quot;, ser);\n    c.setTheme(dojox.charting.themes.PlotKit.blue);\n    c.render();\n    c.theme.plotarea.fill = undefined;  // Transparent background\n    return chart;\n},\nwidth : chartSize1,\nheight : chartSize1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>};\nvar graphFeature1 = new dojox.geo.openlayers.WidgetFeature(descr1);\ngfxLayer.addFeature(graphFeature1);</pre></p>\n<p>Similarly, we create a second widget feature with a stacked area chart with different dimensions and location:</p>\n<pre class=\"brush:js\">// Add a second plot feature\nvar chartSize2 = [300,200];\nvar co2 = [15,45];\nvar descr2 = {\n    // location of the widget\n    longitude : co2[0],\n    latitude : co2[1],\n    // the function which creates the widget\n    createWidget : function(){\n        var div = dojo.create(\"div\", {}, dojo.body());\n        var chart = new dojox.charting.widget.Chart({\n            margins : {\n                l : 0,\n                r : 0,\n                t : 0,\n                b : 0\n            }\n        }, div);\n        var c = chart.chart;\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    c.addPlot(&quot;default&quot;, {type: &quot;StackedAreas&quot;, tension:3})\n    .addAxis(&quot;x&quot;, {fixLower: &quot;major&quot;, fixUpper: &quot;major&quot;})\n    .addAxis(&quot;y&quot;, {vertical: true, fixLower: &quot;major&quot;, fixUpper: &quot;major&quot;, min: 0})\n    .addSeries(&quot;Series A&quot;, [1, 2, 0.5, 1.5, 1, 2.8, 0.4])\n    .addSeries(&quot;Series B&quot;, [2.6, 1.8, 2, 1, 1.4, 0.7, 2])\n    .addSeries(&quot;Series C&quot;, [6.3, 1.8, 3, 0.5, 4.4, 2.7, 2])\n    .setTheme(dojox.charting.themes.PlotKit.blue);\n    c.render();\n    return chart;\n},\nwidth : chartSize2[0],\nheight : chartSize2[1]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>};\nvar graphFeature2 = new dojox.geo.openlayers.WidgetFeature(descr2);\ngfxLayer.addFeature(graphFeature2);</pre></p>\n<p>Once we have all the features in the layer, it is a good idea to refresh it:</p>\n<pre class=\"brush:js\">gfxLayer.redraw();</pre>\n<h2>Conclusions</h2>\n<p>I think the fusion of Dojo with OpenLayers opens new possibilities to create rich content and behavior mapping applications. We can create <em>dojo features</em> and make them really amazing using effects, animation and events (like <a href=\"http://dojotoolkit.org/documentation/tutorials/1.6/charting/demo/monthly-sales-moveslice.html\">this</a>).</p>\n<p>I usually work with OpenLayers and, because Dojo simply acts as a wrapper on some OpenLayers classes, we can access them and work directly adding data from WFS server, GML files, etc</p>\n<p>Is it a perfect solution? As always it depends on your needs but for all of us which work in complex RIA applications that needs some GIS features the <em>dojox.geo.openlayers</em> package offers a new spot light :)</p>","excerpt":"Recently, the new Dojo 1.7 was released with many improvements and important changes.\nAs a developer, I'm pleased to work with Dojo on RIA application because simple reasons: </html> // Create a map instance\nvar map = new dojox.geo.openlayers.Map('map');\nmap.fitTo(-10,30,40,62); // Add to the GFX layer\ngfxLayer.addFeature(feature);\ngfxLayer.redraw(); };\nvar graphFeature1 = new dojox.geo.openlayers.WidgetFeature(descr1);\ngfxLayer.addFeature(graphFeature1); };\nvar graphFeature2 = new dojox.geo.openlayers.WidgetFeature(descr2);\ngfxLayer.addFeature(graphFeature2);","frontmatter":{"date":"23 January, 2012","title":"Dojo + OpenLayers = New Challenges"},"fields":{"slug":"/blog/2012/01/23/dojo-openlayers-new-challenges","readingTime":{"text":"8 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2012/01/23/dojo-openlayers-new-challenges"}}}