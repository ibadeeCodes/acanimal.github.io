{"componentChunkName":"component---src-templates-blog-post-js","path":"/2015/07/26/generate-and-host-your-own-raster-tiles-customized-with-mapbox-studio/","webpackCompilationHash":"1ee04d26e703fb0db201","result":{"data":{"markdownRemark":{"html":"<p>If you have never saw maps hosted in Mapbox platform you would probably agree on the quality of its designs. The business of <a href=\"https://www.mapbox.com/\">Mapbox</a> is to host and server geospatial data. For this reason, all the great tools Mapbox facilitates are oriented to help their users to prepare and work with their data.</p>\n<p>One of the provided tools is <a href=\"https://www.mapbox.com/mapbox-studio/\">Mapbox Studio</a>. Mapbox Studio (MbS) is a desktop application that allows to create <a href=\"https://www.mapbox.com/guides/cartocss-in-studio/\">CartoCSS</a> themes that are later used to generate raster tiles. Briefly explained, what MbS does is to download OpenStreetMap data in vector format and render it on the fly applying the specified CartoCSS style.</p>\n<p>The result of working with MbS is not a set of tiles but a style, that is, a set of rules that express which colour must be used to render roads, at which levels must labels appears and with which size, which colour must be used for ground, etc. This style can be later uploaded to Mapbox platform so that raster tiles were generated on the cloud and we can consume the tiles paying for the service. (Hope one day I can contract their services, they deserve by their great job).</p>\n<p>The question we can make us is: <em><strong>how we can generate the raster tiles locally from a given MbS style?</strong></em></p>\n<p>Well, this article is about that. Continue reading.</p>\n<h2>Working with Mapbox Studio and create your custom style</h2>\n<p>Let's start from the beginning so <a href=\"https://www.mapbox.com/mapbox-studio/\">download</a> Mapbox Studio application and install on your system. Once installed execute it and you will be asked to be connected to the Mapbox platform.<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACMElEQVQ4y52RS08TURSAZ4HxD6AWTFlJ3LjoUCnzqCVEQ0ElkyoJbsQYY9KGlQuCS+j7GQmi4itxobFsjAnBGXVmStspBZq2GzWuYMFGRV2YsBCZOd47M0UKvif5ck7O47snGeKpd3JPVpodFMqLQ/PVt16l8tqnVN74cCxUjTgjKb7ZTFHPFbNmzOi5F80N5cuvLjyYfrKXOHx8cH9vQljn7lWAu7UE3FRpF303FxE/7+Edz90q9KbEr0f6rxwkGinOQo7y7+yhDLQFxQ3Et52Qgd21bWzYQzKQo8/Wmk9ctBIW5ozF4ec/0PEcUBFJRWjbYaKy5opnNGcso9ERWdvZxzt0LAuOgPDJ6r6EhR4sXMPCjrCkInDEcnCEJDgaFOH0dQVOTuTBjvL2kNGrzeEdCgv9wmdr9y+EVETWZd3XcnDuzgL0TxVh4PYCnL+/BO7xnCmVt4T0n4XoOhQ7E3PQN6nAqQl8oQLcjYJec4Trrvw7IY7OmAyuuIwuzUIPugznuKaL/kVYG2aiGehMZvWrXCa49lvhAdpjaffz76noHGqKm6ZUhw2/ULsigtoVfa6yQV6lx2ZUKsCbfbEWNyn0CDrqo3Ehe7apI/Tyi3O8BEyyAEyquAWbKoAzqcCxlAJMIg/4bzIJpW6GSc4Di3aRY72l53IL0djm3mcbflgiR9Kr5MjjZcTKD9IrNhOck1enjVg3g3fSq7bhR+Um10Azgb4GhBXRijj0n7SajobvHTYzwwGFeyUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015 07 25 at 23 43 15 1024x680\"\n        title=\"Screen Shot 2015 07 25 at 23 43 15 1024x680\"\n        src=\"/static/928f9885bb7091dfc023cd9b14b45a27/dbb61/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png\"\n        srcset=\"/static/928f9885bb7091dfc023cd9b14b45a27/19bd1/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 163w,\n/static/928f9885bb7091dfc023cd9b14b45a27/d3bcb/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 325w,\n/static/928f9885bb7091dfc023cd9b14b45a27/dbb61/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 650w,\n/static/928f9885bb7091dfc023cd9b14b45a27/6b691/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 975w,\n/static/928f9885bb7091dfc023cd9b14b45a27/3b243/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 1024w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>There are two main reasons why Mapbox requires you to register as a user. First, the power of the platform is on the cloud and the goal is you upload all your data to the servers. That includes the styles you create.</p>\n<p>Second, MbS retrieves data in vector format from Mapbox servers. When you register as a user you get an API token that identifies your requests. Each time MbS makes a request to extract data it has your token that identifies you as user. This way Mapbox can control if any user is making a bad usage of their platform.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACm0lEQVQ4y52Q60tTcRjHzwujF4WX6XRrHt3lnM2d4za3lWlKkZvkxirMEaLVyLBcRhkVhlBohYRQidmFbr7oJpkTka5CtHOkN1L9BSnRm8qMiJTytPP0/I5rGSpEP/jwnPM83+/3d6EiofYlzwZv7ngoPGocEV80REUxLCBRQQiLiCBEw4MDkfAQIuI36ZGZ8Fsnig2CONL4PCqEbvT0LKVonT6zsHTdVIm3Ako8c/D6odjjhyJSq7ZBcWUtrPb4oAh7JeX+hG6NZwOUen1QuLbsh5616KhlqSqNjuHeZ7M8ZLPcTLaZl3RGVrLWHJPWt/VL3uN3JM+JPuS+5GvrlbwnI5J1eytqzBLRKh6WAx1jnUhOV9NUiipDY+DsH035TjDyBTFjvlM2WDjZvf+SHLj8Sg50ibLnTFQuQ8rPIt2jsqvpqmzI42WiJR7iNXCOSVWmlqaSMVBvtU/gAJsYyOPQwoFzbye4WvrA0XQdHAd7wI7YDlyDgqP3wLWvGzU8KB5yCKyY8TltfqAjEZi/pxNWtT4AV3Mv2I70Anf4LnCHbgPfMgh8+Lyi+efAXDMHFc0XYcu5JxA41Qeb2vsh2DEAwdP9UN31FPwtVxSNsrniWTBw9g3Je+hMeTD0eBhuvZ6EjuE3cEF4C1++TcPM92kgSxRF0BotkHj3RQPju+Xm2cBXuRWqQrthY00dbK7dBTU766G2rh5C9WEIBKsVzZ9bzQ/8EB/+jAtieIJYVq4pptEzsSxEnWNCmFgGjT2DWdEQLfHEAz/FA9VabH5l7G7lCiabC6sLWPxnHSsTmOfA/qV1AmNzk8NMqbK0OdTy1DQ1zVpHc8zcO5rlxpDxhcD5+CKzsVmv9WVKeuYKClcSQiMswvwnbDwj6Rfcsph85R2QtwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015-07-25 at 23.43.26\"\n        title=\"Screen Shot 2015-07-25 at 23.43.26\"\n        src=\"/static/c4bef936ec3084ba5ef4c05341dc0817/dbb61/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png\"\n        srcset=\"/static/c4bef936ec3084ba5ef4c05341dc0817/19bd1/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 163w,\n/static/c4bef936ec3084ba5ef4c05341dc0817/d3bcb/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 325w,\n/static/c4bef936ec3084ba5ef4c05341dc0817/dbb61/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 650w,\n/static/c4bef936ec3084ba5ef4c05341dc0817/6b691/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 975w,\n/static/c4bef936ec3084ba5ef4c05341dc0817/3b243/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 1024w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Once logged in you will be allowed to create new map styles. The easiest way is to start using one of the starter styles created by the great Mapbox designers:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADdUlEQVQ4y5WSXUybVRjHXwnIFifYZa0vmhISviwGtND2bSlQwHYt7cZHqVtphJYOcQ0JqF0C65dVRoGRTZbRWWtLtwnqROVCw4U6hN4aQwL3ey92o1Z3YbIL15337+nrtsRLL/55nnOS8z+/54PZdM+V/PD16sh3P307kd3Jnr19+0ff9va2b2dnx5fNZn27u7u+zc1N39bWlu/g4IBq37e/v/8oF3V2b29vgr5xLy8vlzLSw4dkKqvzfscJB05ae/Ca0Yju7m6YzWZYbTZYrVYY6Z3dbkckEkEwGBQVCASexFgsBq/X+3dVVdWLzNMlRays+uVfG15pgcVkfKDVavMqlSpfiFqOy+u0nJjr9fp8W1ubGAvq7OzMt7e353U63YORkRHMzMzkNBqNnCkrL2crZNLfm5VKeMbeIk7XG8Lw8LDQ2z8g9A4OCrZ+u9Bvtwsmo1GgpEJXV5fQ0dEh9PX1CRaLRTAYDGR0dBShUOhPai5nJEePslKZLKfV6ZD6coskNr7Hzc++wZvvnMOQP4B3Y0uYjkahUChQX18vipKgrq4O1dXVqKysJBQA4XD4nkgokUhYqVSa4zgNVlMpkrl+AysrKzjn9+Na/Bpu0HM4HCkQIJ1OIx6Pw+12o6mpSTRubGwkhXPBkOM4OXPkyLNsRQWbU2l09HGKbKwnkUx8hGA4hCQ1W1tfxeLiLObn57G+tobrmQzOeL2g/RSHRct/XPK9f0sWCY/lVGoNrsQvkkTyMpYuzcN/3o8P0wkkPk3ivbkIps8HsLB0EdHZ93Ha6USbXg/aT9ABPTGkw5Mzsudl7HMSSU6jVuHC1UUSvRJDaCEC3/QEglc/QPSTBGbmZuF0ezE2+TZc4+M4bjtRIBMNKel/DY/JWFZSXvbbS00tWEhmHn5x6yZJpz4mg45+YjKbiMNhJxbbSTJ9YZF8dWuVbHyeIWNnPKS1tZVQQ0IJH3o8nsJO/iEaPnPocEVNbc1fOk6LOcspXHIMYWFyki7ygNgjS08PTMfN6B0YwJDrdbhcp+iy91C67sc9xDilpkt/n35SyRQ/VSRVNDT83KJ89e5wnfKOW9HMn2438AZtK6/hOJ5OjqcLzqvVKr65uUUUnS5PaXg6BHqvvuNwOO5OTU39olQqX2BKSkuLGYaRU9Uy5UU1TFlxDc3/r2ofeRT/AwfV0+tthqF/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015-07-25 at 23.47.38\"\n        title=\"Screen Shot 2015-07-25 at 23.47.38\"\n        src=\"/static/8555c62ce7a37effc9ba46d7e4f1ac2c/dbb61/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png\"\n        srcset=\"/static/8555c62ce7a37effc9ba46d7e4f1ac2c/19bd1/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 163w,\n/static/8555c62ce7a37effc9ba46d7e4f1ac2c/d3bcb/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 325w,\n/static/8555c62ce7a37effc9ba46d7e4f1ac2c/dbb61/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 650w,\n/static/8555c62ce7a37effc9ba46d7e4f1ac2c/6b691/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 975w,\n/static/8555c62ce7a37effc9ba46d7e4f1ac2c/3b243/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 1024w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Here we have chose the <em>Mapbox Outdoors</em> style. In the image you can see the style code (CartoCSS which is inspered by CSS) and the resultant tiles obtaining from painting the vector information with the given style rules:</p>\n<blockquote>\n<p><a href=\"http://wiki.openstreetmap.org/wiki/CartoCSS\">CartoCSS</a> is a <a href=\"http://wiki.openstreetmap.org/wiki/Mapnik\" title=\"Mapnik\">Mapnik</a> <a href=\"http://wiki.openstreetmap.org/wiki/Stylesheet\" title=\"Stylesheet\">stylesheet</a> pre-processor developed by <a href=\"http://wiki.openstreetmap.org/wiki/MapBox\" title=\"MapBox\">MapBox</a> and inspired by <a href=\"http://wiki.openstreetmap.org/wiki/Cascadenik\" title=\"Cascadenik\">Cascadenik</a>. It is like a CSS language specially developed to style maps.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADUklEQVQ4y52Ty28bVRTGZ1HEgrJAVStDcUwU6pCoz+B/gSV7ViB2tbKLIkFLWyuJ01aFVlWDVFLxkNiQsEE0FSoQO3GcpPakTuJ3Zsb2zDh+T2bsOH7EHt/5uHZKJLYc6dPR3fz0feecyzz9/M5rrt9++nTBtTDqdq1cXVx0291uj3152Wv/+y+X3UXfc3O/2hcW/rAnEgk7zwv2nR3OznHHusrz/KjH4/lsamrqdWbgrTfOfHztu/rY/Sf4/vEDzD75FrOzM/jxh8d4NHMf3zy4B6fzFuZ++RndardbaDYaaDabxyKEYH5+vmWz2c4y7717ynTho08Kt2ceoqyF2oXilp7LBvQ8VVJm9Z3ECz3G+fUdidNrlZquaRVdq1T1dqulHx4edtWmhUqlojgcDjNjHbSaLgwNlhy3voAkhUmc9xlJ+aUhpTcNUWaNVHrbYAXBCMqyoaZVIycphpAuGOX9A6Nerxu1Wo1QKMrlsup0Os3MwEC/6fz5i8pXN79EIOgj3rVlLHn/xPLKIthND4JxFj5eQFiWUM5qyGcU8LtFNF7Fpp3out4FapOTk2ZmcHDANDQ0rEw5ryOnBEmU82ErvIpAyIuN7SWEOS9YgUNIkqCm95ChQDmvollv9KDUHenOkEY+AlosZ02XLl1W7n3tQL0uEEncQDa7BTnNIhxbQpDbBJtIICSK0PIa1KyKfGGPqoT9agUHBzXSarWgqqrWm+HwsNVktX6g3L17A+UqR3jBB4663A6/gD8UgJ/nj4CSCDWjokBdypJCARro/LqxSafT6TmcmJgwMx/aLpssln5l0nkNRTVCItw62HicQpLYSCbxksJY4QhYEksoSSr4VBGqUvn3bI6BvchdYF+fpXj95jiyhVBnkwsRfyJJqDNCt0somPhoD6aSZF+tkGq5SsrVA1JvNkgXRufY6UamS9nrOezv73v7ypWR6u07N5BVJQQzOUTzOURyR53Py4jmMpCUHEhbR/fmemXgP0Xj16enp/uY02dOnR4ZsW2Mj4/uuvzrqd89K+IzL9XqqvjUvSiurz8Tn68tic9X18RoJCJGo1ExFouJ8UhcpF9OFAQhRb/kbjweD4yNjb3DnDz55gmGYcxU56je/58694px4h8FNvF7WSGOxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015-07-25 at 23.54.20\"\n        title=\"Screen Shot 2015-07-25 at 23.54.20\"\n        src=\"/static/7d14da8bc929b84b9233767d305f1f9c/dbb61/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png\"\n        srcset=\"/static/7d14da8bc929b84b9233767d305f1f9c/19bd1/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 163w,\n/static/7d14da8bc929b84b9233767d305f1f9c/d3bcb/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 325w,\n/static/7d14da8bc929b84b9233767d305f1f9c/dbb61/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 650w,\n/static/7d14da8bc929b84b9233767d305f1f9c/6b691/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 975w,\n/static/7d14da8bc929b84b9233767d305f1f9c/3b243/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 1024w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Store the style with a new name somewhere on your computer, for example, <code class=\"language-text\">customstyle</code>. If you look at your disk you will see a <code class=\"language-text\">customstyle.tm2</code> folder has been created containing a bunch of files that defines the style rules (take a look they are not dangerous).</p>\n<p>Finally, modify some properties, for example <code class=\"language-text\">@land</code> or <code class=\"language-text\">@crop</code> colors and save to see the result:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADb0lEQVQ4y52T3U+bVRzHn4sZL+aF0bjULR0F6YXbYOvQv0Ljn6DxwmTNksnY3OLILBQqRVmoi/FOBrqpyMQ8faOjpaWl0PUFJqNvtB3PsEXo+wt9oTw9z9fT7iXx1l/yzTnn4nzy/f7O+THsp+pXbOzUx3qb4aLD5rxgX3TIl+xO+bJzRb5gsckXzFb59K8zcp1+Th6LxeSRSFQeDoflm5ubL3QhEolcDIVCn8zOzr7KSNvaj3304QeVvqu9+P4HDcY0oxi/PfZsP67Gre9GoVTdxC/37qBZh4d11GpVqlpL1WoVhBAkEon6yMjICUYsOSHq7pbtKZTXsfFk6dD5l5FfcLO80X6fX1zX8fYQy88/1PEmj4+vFit8JpPnk9kCX6/X+YODg6YOaaFYLKYHBgbETKe0Q9TddTbVr7iOR6EV8tBvFtybFsEVoGvYJLj8VmFMtyxMLAWEYiInxLeSQpDbFXKFklCpVIRyuUwoFPl8Pjs0NCRmJO+0ibrOdKWv9PfCsvqA6K1asIt/QGubpWctTB4Thlk3fnb6UdrNYyeRQjSebEV9HpnwPI9CoZBTKpVipqNTIjp96kz62s1euGPzxBO0wvH4AUw+Fgbffcyv/Q7N3DLuOPwo7mQRj6ewvZtFrVJtQak70uzhS6Do+DHReVkPBV6GO2ghFhcLx5oRgSeLcAb+BOuew6jegynHBoqpPDIUurvXVArFUgH7+2VC+4lsNptTKBTUobRddOrd0+krX16CK2glSz4T7B4DLC4z7s5boDF6MKz14qclCvwnh72/M9h+mqaAHGj/mrFJo9FoORwcHBQzsvPdIomkI92vuIrgzgpxrs9hwrwCtd6HUcMabhl9+FrnxRQFZrfTSD7NIrKVRDZdePF1XgJbkWXvnRW1nZQkr311GbE9V+Oe1UxUWi/5xkCl9xK1fpUMsR4yaV8n5XyRFPMlki/tk0qtSpow2sdGMzJ95UzLYVu7+G3ZuZ7SsPoGPLE1aCwBaKxBaBaerRPODdy2Pob2URSgTpqXWyXgP0XjV1Qq1UnmjTdff6un533vpc8/i4/PsFtf/Gjg+if13I1JA6eY1HLTurvc2G8z3LfTZi4c9HN+f4ALBoNcyB/i6Mhx0Wh0i45knI7eal9f33Hm6NHXjjAMI6aSUnX+T0mfM478C8gp2Jh7gedDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015-07-25 at 23.54.47\"\n        title=\"Screen Shot 2015-07-25 at 23.54.47\"\n        src=\"/static/50ca2991cafbf2042a25c345746d1800/dbb61/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png\"\n        srcset=\"/static/50ca2991cafbf2042a25c345746d1800/19bd1/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 163w,\n/static/50ca2991cafbf2042a25c345746d1800/d3bcb/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 325w,\n/static/50ca2991cafbf2042a25c345746d1800/dbb61/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 650w,\n/static/50ca2991cafbf2042a25c345746d1800/6b691/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 975w,\n/static/50ca2991cafbf2042a25c345746d1800/3b243/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 1024w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Great !!! You just have created your first custom style.</p>\n<h2>Generating raster tiles from MbS style</h2>\n<p>Looking for a solution I discovered the <a href=\"https://github.com/mojodna/tessera\">tessera</a> and <a href=\"https://github.com/mojodna/tl\">tl</a> tools. <em>Tessera</em> is a node based command line application. It is based in some modules from mapbox (concretely tilelive) plus others implemented by the author (<a href=\"https://github.com/mojodna\">Seth Fitzsimmons</a>). The result is we can execute tessera passing a MbS defined style, open a browser pointing to a local address and see a map with the raster tiles generated with our MbS style.</p>\n<p>Similarly, <em>tl</em> is a node based command line tool we can execute, passing a set of options, to generate a <a href=\"https://www.mapbox.com/guides/an-open-platform/#mbtiles\">MBTiles</a> file or a pyramid of tiles following the well known <code class=\"language-text\">z/x/y.png</code> format.</p>\n<blockquote>\n<p>I know about both tools at the article <a href=\"http://www.azavea.com/blogs/labs/2015/05/converting-mapbox-studio-vector-tiles-to-rasters/\">Converting Mapbox Studio Vector Tiles to Rasters</a> from <a href=\"http://www.azavea.com/\">Azavea</a> Labs.</p>\n</blockquote>\n<h3>How to install the tools?</h3>\n<p><em><strong>NOTE</strong>: You need to have <a href=\"https://nodejs.org/\">NodeJS</a> installed in your system, along with the npm package manager command line tools.</em></p>\n<p>I don't like to install global node packages (or at least more than the necessary) so I'm going to install the previous tools in a custom folder:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>mkdir tiletools\ncd tiletools\n{% endhighlight %}</p>\n</blockquote>\n<p>Inside the directory execute next sentence, which install the <code class=\"language-text\">tessera</code> and <code class=\"language-text\">tl</code> packages among others:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>npm install tessera tl mbtiles mapnik tilelive tilelive-file tilelive-http tilelive-mapbox tilelive-mapnik tilelive-s3 tilelive-tmsource tilelive-tmstyle tilelive-utfgrid tilelive-vector tilejson\n{% endhighlight %}</p>\n</blockquote>\n<p>You will see a hidden directory named <code class=\"language-text\">.npm_modules</code> has been created which contains some subdirectories with the same name as the previous packages.</p>\n<h3>Running tessera</h3>\n<p>Let's try to run tessera for the first time. Because it is installed as a local node module execute:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>./node_modules/tessera/bin/tessera.js</p>\n</blockquote>\n<p>Usage: node tessera.js [uri] [options]</p>\n<p>uri     tilelive URI to serve</p>\n<p>Options:\n-C SIZE, --cache-size SIZE          Set the cache size (in MB)  [10]\n-c CONFIG, --config CONFIG          Provide a configuration file\n-p PORT, --port PORT                Set the HTTP Port  [8080]\n-r MODULE, --require MODULE         Require a specific tilelive module\n-S SIZE, --source-cache-size SIZE   Set the source cache size (in # of sources)  [10]\n-v, --version                       Show version info</p>\n<p>A tilelive URI or configuration file is required.\n{% endhighlight %}</p>\n<p>Tessera requires you pass an URI so it can server its content. It accepts URIs from Mapbox hosted file, Mapnik, Tilemill, Mapbox Studio, ...</p>\n<p>Repeat again indicating the path to our previously created style indicating the protocol <code class=\"language-text\">tmstyle://</code>.</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2\nListening at <a href=\"http://0.0.0.0:8080/\">http://0.0.0.0:8080/</a></p>\n</blockquote>\n<p>/Users/antonio/Downloads/tiletools/node<em>modules/tessera/server.js:43\nthrow err;\n^\nError: A Mapbox access accessToken is required. `export MAPBOX</em>ACCESS_TOKEN=...` to set.\n...\n{% endhighlight %}</p>\n<p>First seems tessera is working at port 8080 but later we get an error about <code class=\"language-text\">MAPBOX_ACCESS_TOKEN</code>. If you remember from the first section, Mapbox requires all the requests be signed with the user token. So, you need to get the access token from your account and set it as environment variable before execute tessera:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>export MAPBOX<em>ACCESS</em>TOKEN=your<em>token</em>here\n./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2\nListening at <a href=\"http://0.0.0.0:8080/\">http://0.0.0.0:8080/</a></p>\n</blockquote>\n<p>/Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43\nthrow err;\n^\nError: Failed to find font face 'Open Sans Bold' in FontSet 'fontset-0' in FontSet\n{% endhighlight %}</p>\n<p>We are close to make it work. The problem now is our MbS style is using a font we have not installed in our system. One easy, but brute force, solution is to install all Google Web Fonts on your system. For this purpose you can use the <a href=\"http://webfontload.com/\">Web Font Load</a> installation script. In my case I have installed them in the user's fonts folder <code class=\"language-text\">~/Library/Fonts</code>.</p>\n<p>Once fonts were installed try executing tessera again:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2\nListening at <a href=\"http://0.0.0.0:8080/\">http://0.0.0.0:8080/</a></p>\n</blockquote>\n<p>/Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43\nthrow err;\n^\nError: Failed to find font face 'Open Sans Bold' in FontSet 'fontset-0' in FontSet\n{% endhighlight %}</p>\n<p>That' s a bit strange, we have just installed the fonts but they are not found. What is happening? Well, tessera uses mapnik to create the raster tiles and it looks for fonts in the folders specified by the environment variable <code class=\"language-text\">MAPNIK_FONT_PATH</code>, so let define the variable:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>export MAPNIK<em>FONT</em>PATH=~/Library/Fonts/\n{% endhighlight %}</p>\n</blockquote>\n<p>and execute the script again:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2\nListening at <a href=\"http://0.0.0.0:8080/\">http://0.0.0.0:8080/</a></p>\n</blockquote>\n<p>/Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43\nthrow err;\n^\nError: Failed to find font face 'Arial Unicode MS Regular' in FontSet 'fontset-0' in FontSet\n{% endhighlight %}</p>\n<p>OMG !!! This seems a never ending story. Now we need to install the Arial Unicode font. <a href=\"https://code.google.com/p/tuanphamvu/downloads/detail?name=Arial%20Unicode%20MS.rar&#x26;can=2&#x26;q=\">Look for it</a>, install in your system and execute tessera again:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2\nListening at <a href=\"http://0.0.0.0:8080/\">http://0.0.0.0:8080/</a>\n{% endhighlight %}</p>\n</blockquote>\n<p>Great !!! It seems tessera is working fine. Let's go to open our browser pointing to <code class=\"language-text\">http://localhost:8080</code> and see the result:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.81916038751345%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAADyUlEQVQ4y6WUW2/TZhzGOy42pnIzdrMLPsG+xaR9BXLB5T4AGtI+wCTQytqNlgwQqzZttB095FjHZzuxc7Kd2G/SOAfn0KTtCCpiXBAuwfazNyllVGPiYpYe/WXr9e99/s97mJub+2pu1Kp/0dtvXvF6+5e7XjfS7/cjo9EoMhgMIv1BP9Ltdql6kW6vG+n1ejNNvw36g8j4z6PL4/H4iud5X87Nngufn29UCnuH4z4GwwOMRkPQgXhyfIzH48d4+uQpXkxeYDKZYPL8RM+nlb7/9ewZPDr28OAAhDgdSvtghjRrFYe0CaxG6ZXRLgaaJwU5TwyMrhbYg2JADktBfWQGztAIakflwDrSg+G4HuTtenBXcl79nndxjy25lPXRFDhv2hYpVC0wIufzMh9mTCaMlxNhppgOk2o8FG0hFBrpMF3bCVPNzbDgSWHVlcNf5EJ4g3H8W9k2vo0VmpT14QyYKSdI3lMRz8f9dG4XbJ6DUBShmjJi2ja22AQkXYFAOEiNDAodGWo1iYeqjjtM0V9Va7ieKP4D3HU2Sf4RB76T8BWXg9YQUarlINsCmL1tMGYSiiEiW5GRMVhsWOtIkk0otogVwfJXqMMb8bccMvoOMQYqcm3G1/s8KvsqnG4BmitAcHepUkjXNsG4O2AbcayTVSjtFJ1AQVQyacuds8CU/AcpuQpKdcl3OhoqIxVFGkHJk6D1eOQ9EWZfpRNJUJq7iLc2UGiz0PdERMXKCTDxGvjJ+fl50YgRs6Uga7N+tsoiR7PKN6RZtVwVzWER9b6Oal+G0Ioh426h2mWpax4/8ra//DZw6pArb5N6X4NGWF+00uD0BLg8VZEuhpEGaWswXQliKwm5kYBcS2Hb0PEDb+MmS/zbuTaun2k5u0UKLg2dMH6+JkEy03QVd1HYE2BQ52SYg+3JMBwG6ZyMqGBhIUOwyDlY4hwK7JwFxhSaYTsLtSb5ZerGauRg9VRoHQZGnadtZ2n7WWzqGpYzFm5yBEu8M9Piu4BcMUaMlgq7pfnVpgabQusDHZypYl3J4Z5UoVkRLLAE37+BnTh8J7Dc4EljVEJ1qPhyM41yU4BKirMfFtjaNCcKct64OoW9rv8GVlzF7j2yoQ0yL9POjp+vsP5vsuIvsI6/xNn+NKfF/5T9cllpToGNU+AFuZlsH05cdI8rdIuUwNs2orqH25qH6Hs0PSX3rSN8lzIGp8CP7ydu/brG/FxPZB6YG4lV65s7a9bV6KZ17aeH1tfvl3Ht7lb96srag9Pb5hzVRapL/1MXP/3s0rm/AWZHxY8dZvjwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015 07 26 at 16 01 43\"\n        title=\"Screen Shot 2015 07 26 at 16 01 43\"\n        src=\"/static/93475e0853caa70a4aeb267f060319c9/dbb61/Screen-Shot-2015-07-26-at-16.01.43.png\"\n        srcset=\"/static/93475e0853caa70a4aeb267f060319c9/19bd1/Screen-Shot-2015-07-26-at-16.01.43.png 163w,\n/static/93475e0853caa70a4aeb267f060319c9/d3bcb/Screen-Shot-2015-07-26-at-16.01.43.png 325w,\n/static/93475e0853caa70a4aeb267f060319c9/dbb61/Screen-Shot-2015-07-26-at-16.01.43.png 650w,\n/static/93475e0853caa70a4aeb267f060319c9/356ef/Screen-Shot-2015-07-26-at-16.01.43.png 929w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>A map implemented using Leaflet web mapping library is shown, rendering raster tiles that are created in the fly. Look at the console to see the tessera output information:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.67983367983368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAACHElEQVQ4y62UTY/SQBjHC7QLhBd567qUzpQKhf0O6s3voE28euAzeLAm3gDlJUFT1s1+iQ0nLx69u7uFIbjSxaxvMYEKlMP6DLBEswmY7jb5JTOd6a/zfzpTZo+5YL4b7x/0f3Yej63pI2tkqaPRaI71e6wOfvxSTdNUz8+/qoMvA3U4HKqTyUQdj8craN+yrIe9Xi/KeF23/PVXxQ/7B28v9L3m9E3z9aypN2e6rs8ajYb9slKZFotFu1wu25VKxa5Wq3atVvubab1et0ul0qRQKNxj4ArF4olDURBPE8m4sRXh2rFIzIjGoobH4zmG8Y//yRFwlwqDGOPWbn73TM6lCZ9OdGVJJnCPhMPhNoyfuFwuAzhZg+F2uw2O4xZChFArr+TPcAYRXqLCO91UKrUSAsYaVuMsyy6EIhJbSlYxcRaTBI53sYhJUkgSv9/vUCiCMKOYCFZ4KRQEgfh8PmdCGpkKaeTtNN+VkETgJSQYDDoUYjSPjJY1pCukwkAg4DxyNpP9p4Y08vVquPwocRQD4SKyY+G8htlFDW9khVSYU3KryCh1Zdts4so+PISN3ZcUqb0t8ySN0x04KZ1QKEQnHm/g6LI9F8JDIYj3Dono2454+3M0GTGFHaHP83zf6/WewsQe8GkNq3EQ3mcgrg/22xPovGA59pmH9WhwJjVoa/Bz0OCcanBON/EceArzZWZ5uQHuGmwBLOD6A5IOX5M8xJf9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015 07 26 at 16 03 20\"\n        title=\"Screen Shot 2015 07 26 at 16 03 20\"\n        src=\"/static/7fd6122a6dd6f365ef57506522a7f15a/dbb61/Screen-Shot-2015-07-26-at-16.03.20.png\"\n        srcset=\"/static/7fd6122a6dd6f365ef57506522a7f15a/19bd1/Screen-Shot-2015-07-26-at-16.03.20.png 163w,\n/static/7fd6122a6dd6f365ef57506522a7f15a/d3bcb/Screen-Shot-2015-07-26-at-16.03.20.png 325w,\n/static/7fd6122a6dd6f365ef57506522a7f15a/dbb61/Screen-Shot-2015-07-26-at-16.03.20.png 650w,\n/static/7fd6122a6dd6f365ef57506522a7f15a/d418b/Screen-Shot-2015-07-26-at-16.03.20.png 962w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>We can see how tiles at current zoom, the zoom level 8, has been generated.</p>\n<p>At this point we have tessera working but what about generate a local pyramid of tiles for a given zoom levels and a given bounding box?</p>\n<h3>Generating a custom pyramid of tiles with tl command line tool</h3>\n<p>Before continue we need to know which bounding box we want to generate, the whole World? or only a piece. In my case I want three zoom levels (7, 8 and 9) wrapping Catalonia.</p>\n<p>There are some online tools you can use to get the bbox of a region, but one I like it the <a href=\"http://boundingbox.klokantech.com/\">Bounding Box Tool</a> from <a href=\"http://www.klokantech.com/\">Klokan Technologies</a>.</p>\n<p>The tl tool can run three main commands but are only interested in the copy one, which copies data between two providers. In our case the MbS style is one provider and the file system is the other. Run the tl command to see the available options:</p>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>./node_modules/tl/bin/tl.js copy --help</p>\n</blockquote>\n<p>Usage: node tl.js copy <source> <sink> [options]</p>\n<p>source     source URI\nsink       sink URI</p>\n<p>Options:\n-v, --version                 Show version info\n-b BBOX, --bounds BBOX        WGS84 bounding box  [-180,-85.0511,180,85.0511]\n-z ZOOM, --min-zoom ZOOM      Min zoom (inclusive)  [0]\n-Z ZOOM, --max-zoom ZOOM      Max zoom (inclusive)  [22]\n-r MODULE, --require MODULE   Require a specific tilelive module\n-s SCHEME, --scheme SCHEME    Copy scheme  [scanline]\n-i FILE, --info FILE          TileJSON</p>\n<p>copy data between tilelive providers\n{% endhighlight %}</p>\n<p>So let's go to execute the command to copy data from our MbS style to the local <code class=\"language-text\">tiles</code> folder. We want to generate tiles from zoom level 7 to 9 and indicating a bounding box wrapping Catalonia.</p>\n<blockquote>\n<p>Remember the <code class=\"language-text\">-b</code> options must be indicated as <code class=\"language-text\">[minLon minLat maxLon maxLat]</code>.</p>\n</blockquote>\n<p>{% highlight bash %}</p>\n<blockquote>\n<p>./node_modules/tl/bin/tl.js copy -z 7 -Z 9 -b \"0.023293972 40.4104003077 3.6146087646 42.9542303723\" tmstyle://./customstyle.tm2/ file://./tiles\nSegmentation fault: 11\n{% endhighlight %}</p>\n</blockquote>\n<p>Ough !!! That hurts, a segmentation fault. After looking for a while I realised it <a href=\"https://github.com/mojodna/tessera/issues/9\">seems a bug</a>. To solve it go to <code class=\"language-text\">tl/node_modules/abaculus/node_modules</code> and remove the <code class=\"language-text\">mapnik</code> folder dependency. It is redundant because there is one installed in parent folder.</p>\n<p>Execute the command again and see the output:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.67983367983368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAABmUlEQVQ4y62UvU7CUBSA29I2NrRAKz+VzYSfh1A330Fv4urAMziIiRNpk5YyaowPYXRycXQWKJgUqJGAicYg6Y8DnosUBxcaOnzp7bn3fjn3np4SF8SM+Og87Nvv3SPP/T50XAc5joNc4Mvx0PPbJ3qxbTQajdHrcIgmkwlyXXe+JgC/T6fTA8uyRIIgGK6hKY9X15czw2i4uq579Xrdx+iAqul+rVbzVVX1NU3zYd4P5hd4hmH4iqK4lUplF4SEIMtbN5K02YPxE9BcPMOC9+1gIV8qle7y+bzN83w7Ho93INYmSdIE2itiUhRlMgzzJ0yn04NEImGKotjFQsBckeVamqZ/hcViMXphJpMZpFIpE8TRCHO5nI2FkWSI71CWZTuZTJogXV9YKBSWGUqSFI0wyDCSI5fL5XmGuMpAJ7IqYyFkGWQYhn9Fuc1ms31BEFpYCrFWCJrBOBAKcIf3cOQxtJ7FcVwfYhbQW5HlWhDuYeEGVPYYevicZdlToAq9WYXeDMMZcBKLxbYJ+FSwlML/sTVgARogfwBXtk/aD7TBpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2015 07 26 at 16 27 56\"\n        title=\"Screen Shot 2015 07 26 at 16 27 56\"\n        src=\"/static/f1704bc2ed5ee13e403f31a4b4096ce1/dbb61/Screen-Shot-2015-07-26-at-16.27.56.png\"\n        srcset=\"/static/f1704bc2ed5ee13e403f31a4b4096ce1/19bd1/Screen-Shot-2015-07-26-at-16.27.56.png 163w,\n/static/f1704bc2ed5ee13e403f31a4b4096ce1/d3bcb/Screen-Shot-2015-07-26-at-16.27.56.png 325w,\n/static/f1704bc2ed5ee13e403f31a4b4096ce1/dbb61/Screen-Shot-2015-07-26-at-16.27.56.png 650w,\n/static/f1704bc2ed5ee13e403f31a4b4096ce1/d418b/Screen-Shot-2015-07-26-at-16.27.56.png 962w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The tl tool has created a local tiles directory and generated all the raster tiles for the given zoom levels and bounding box. The output shows in addition the time required to generate each tile.</p>\n<p>That's all. Now we only need to host the tiles at our own servers !!!</p>","excerpt":"If you have never saw maps hosted in Mapbox platform you would probably agree on the quality of its designs. The business of Mapbox is to host and server…","frontmatter":{"date":"26 July, 2015","title":"Generate and host your own raster tiles customized with Mapbox Studio"},"fields":{"slug":"/2015/07/26/generate-and-host-your-own-raster-tiles-customized-with-mapbox-studio/","readingTime":{"text":"9 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2015/07/26/generate-and-host-your-own-raster-tiles-customized-with-mapbox-studio/"}}}