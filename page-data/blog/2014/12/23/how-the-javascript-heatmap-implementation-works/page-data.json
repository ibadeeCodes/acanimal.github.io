{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2014/12/23/how-the-javascript-heatmap-implementation-works/","webpackCompilationHash":"be865f95712747879b43","result":{"data":{"markdownRemark":{"html":"<p>A <a href=\"http://en.wikipedia.org/wiki/Heat_map\">heatmap</a> is a powerful way to visualise data. Given a matrix of data each value is represented by a color. The implementation of the heatmap algorithm is expensive in computation terms: for each grid's pixel you need to compute its colour from a set of known values. As you can thing, it is not feasible to be implement it on the client side because map rendering would be really slow.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 300px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAADzUlEQVQ4yzWTW0ybZRjHP+92Ycyid2Y6tmSJMS4kxoRsmYcsMcRgNJpdqBcSNZnjwm3xdCFZmEYcCkzCOoYQJgVaoHwFSiktlDOldJSTCO3aQr+vh2+ltJRjgB3g52uMF+/V+77/5/n9n/8jmWNhjEtGmmNeepRFHL4PmVDGmE5A97IP70AerSuXqVv/HH28iUrlG37Z/gx38DzuqTeZj51G1r7HveBh0N+LNBRN0Rj3MO7boT0wxe1MAx1aO3bNTzL/FI8uPIVj/AbViT5x9zHl6lU8wbM8cR5jv+k4/q1sHIsX6Q+MMB8YQhqPPWEkdoArkMG+oGGIl9GgWTBFq4hdf47DT46wLOdgud9OrVqFdeVdpsbOsTCXw+7ICdbHT9Icz0WXKqQxakByxw/wiDMqhNsiKq3LV7Bpl9FtfcH13WImB3Mxrb6OYb2TocAMVcmLFG9eozz9I13zb3Fv6iylG1cp3SmgdL30f8FD+uN7GGN+qlO3BHIHRq2FntgozVoR/u+OMVxzntJMIcVrZQx68liqO43a/BIZ+SSt4a+Qly4w6Pv9P0G3JpAj+7iC+9iiYfSrDWJQTTSkOxm3vwYnJMYrX+bnVCVysACr+irJ28fZbMliozeLjDWLTduLzM2cQZoQ/nk1GA3t0j+3hl055M6yjD5koCFmwhqup2n7bSr3SihbL0OO/oBBuYkpYOYPrQRP4hyPK56H/CMkTK8gDccfY46u0BAJ0hJrp8t7i+aAXWB30/jAQnW4k2JFFFAnGdh4B31qlDnfBgZ/M7XhboyKHtdCNktyNq7Y+0g2NUrt7KfotDpMqh7nYj71mpHySDnGhUXafMsYxJsOZZuWZC3V65doV9N0zowQuXQKeeoGN4XvcjoPa7IIyRHyky48ii2k426qni51kJ6QiztBN9ZQAm/4gP5IlBE1Qn8UahN3KU1fo23eCkclHLZcqrQ29NrX1Kc+QLL7x9jUPY1d/ZVexcKoauXPpQGalqNYkntMJ6FzZZvGVEIgQcf9NeqW7mGOR3GZfsOm5CDHncLPAUH2BpJTSQmcLylZLWJ2YRan6qUuvcVwaBu7uxX7ZDs2byu9fZWYwwomZZL+8ApDsYf0psEiuu1WdZiVGSaD7/0bG0S1Q7F+ZlpWHEJ8kgnHFQzBbwlUi1hUPMPmT89ycEbCNdIqulDpUR/gFf8mIo/EQhxi0TJ0ajs44ttIHoHRFU0IwWJqfHox4QLm3B9hTNfQuFWBLSMz7c1ns+8FLOoYTkWsamSHCe1QZPchA7MJ5Fk/hr/+xhuBfwABi2/Gjr8hjQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2014 12 23 at 18 25 49 300x206\"\n        title=\"Screen Shot 2014 12 23 at 18 25 49 300x206\"\n        src=\"/static/4456a2913101eb03853d997924b2175e/135ae/Screen-Shot-2014-12-23-at-18.25.49-300x206.png\"\n        srcset=\"/static/4456a2913101eb03853d997924b2175e/19bd1/Screen-Shot-2014-12-23-at-18.25.49-300x206.png 163w,\n/static/4456a2913101eb03853d997924b2175e/135ae/Screen-Shot-2014-12-23-at-18.25.49-300x206.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>But OpenLayers3 comes with a handy class, <code class=\"language-text\">ol.layer.Heatmap</code>, which allows to render vector data as a heatmap, so the question is: how it is made?</p>\n<p>Really, the <code class=\"language-text\">ol.layer.Heatmap</code> layer uses a smart approximation to the algorithm which produces great results and is really fast. The steps can be summarised as:</p>\n<ul>\n<li>A gradient of colors is created as a 1x256 pixel size image.</li>\n<li>Each known value is rendered in a canvas as a grey blurred point using some radius. This produces a canvas where the blurred points can overlap each other and create more obscure zones. <a href=\"http://jsfiddle.net/mnmrze6k/1/\">Something similar to this</a>.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 300px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADnklEQVQ4yz2T6VfUVRjHf6/jhcE5aPVCE6M6h6TjkhwpEhhBGBYZZE8Yh9UD5bAJg0QhiLIOdEiWDqCxhJTIIAyiIDEGsgybbDIssgSWUNZ/8OkOL3pxz3nuee7zeb73ud8rzT4b4/X2Jjs7WwwtzNM5OUnHxMTuanz8mMJbdZQ0NjIwNc7OyzUW5qZo/qme8OgoIhPi6erpZuvlOn+J+u1Xm0i3a6sxLc3TPzdLq3EM4+IC82sr/4PbRke5PzbG5u8vGJ8cRast4qyfL4EhQdT/WMuKaZZ/BGznzw1mZieRqirLMUyM8fPQMLWdndTea0X3xEC7gJihXVNTLK4tMzL8G1nXcvD28sTW9j0UCl8qysv4paWJmWdGFp9P0yKUS9naEtoGB7j14AEqtZpTcjlRKSnU6fXohcKe6WnWN1a4Iwo9/M4il3sSFxeNtriAtNQkLijP09Z6h7mZcRrr65BiLl+mobeXGqFOER6OzQfv84mTE8lXs2npaKdKp0PX30fTvbukZGZQcOMa3V33GRsdpOaHCvJyszH0PWRzY5m56XEkTWEh1aLIDM0sKUEeGIijTMZpoVQZqSJUdYHMb76muLSY6qrvyb+RS1HBdYafGpifnaBfwAy/PtqNl00zSBczMohKTkbb0EBWWRm+YWGc8ffHwdkZ+2NHcfrUkeAABQH+fqgvJfBFWAjBQQF06O5idkihgKuUEWRqNOTn5SH5K5V4BQWRU1FBUk4OMh8fzsfHE5GQgLPMFaUynKyr35KWkY4mLQVvHy/k586h69Chf6jHS8z1kM1Bjh45wqnPnZA8RNKssLSpaRdohidkZVFWW8PN8lIyrueRV1lBQ7uOiroaVFEqNALe/6SP+sbbOImmhz+yw0vuQWxMFNLHJ07sQjK1WkJjYzl8/DjmJgmadL67WU5iShL+gQFo8vOpEdByYXLzY5n91yMUJideIlGMoqW5geFBA5K7QoGzpyfxV65gjt/Zvx9bOzucXV3E4a/w8/XevZKL2KuT1FTWVDM4+pRt8WueL8zQJ5QaRwbYWl/itTC4lF5QQHJuLjGpqXxob88eSysOHrLB7bQrcbFRyGQu7LW2Zt9ea95+ax+fnXSgSLz4ygsT//79B6bVJSZM8/QaRxg1DiEpIiKIS0/Hyd2dNyws2GNlhYPjSeSeZ7gYG02i+kvc3GS8e+AAFiJvafkmoaEhtHXrebW1yubmKs09j4gUgnxDgvkPv0ij0tVrVUYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screen Shot 2014 12 23 at 18 27 17 300x190\"\n        title=\"Screen Shot 2014 12 23 at 18 27 17 300x190\"\n        src=\"/static/d772b2047959fa43acec731b32a29f72/135ae/Screen-Shot-2014-12-23-at-18.27.17-300x190.png\"\n        srcset=\"/static/d772b2047959fa43acec731b32a29f72/19bd1/Screen-Shot-2014-12-23-at-18.27.17-300x190.png 163w,\n/static/d772b2047959fa43acec731b32a29f72/135ae/Screen-Shot-2014-12-23-at-18.27.17-300x190.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li>Finally, an image is obtained from the canvas and for each pixels a color is assigned. The color is obtained from the previous 1x256 pixel image obtained the color specified by the grey value (which goes from 0..255).</li>\n</ul>\n<p>The coloured image is then rendered in the map canvas, obtaining a nice effect suited to be used for density maps. The <code class=\"language-text\">ol.layer.Heatmap</code> offers some properties we can use to play better: <code class=\"language-text\">blur</code>, <code class=\"language-text\">radius</code>, <code class=\"language-text\">gradient</code>, <code class=\"language-text\">shadow</code> and <code class=\"language-text\">weight</code>. This last can be configured per feature, allowing to assign a <em>level of importance</em> to each feature determining in more or less measure the final color.</p>","excerpt":"A heatmap is a powerful way to visualise data. Given a matrix of data each value is represented by a color. The implementation of the heatmap algorithm is…","frontmatter":{"date":"23 December, 2014","title":"How the JavaScript heatmap implementation works?"},"fields":{"slug":"/blog/2014/12/23/how-the-javascript-heatmap-implementation-works/","readingTime":{"text":"2 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2014/12/23/how-the-javascript-heatmap-implementation-works/"}}}