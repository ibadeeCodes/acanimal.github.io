{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2012/10/09/improved-performance-on-the-animatedcluster-for-openlayers/","webpackCompilationHash":"4776e6576de27e274acc","result":{"data":{"markdownRemark":{"html":"<p>Yes, now I'm really proud to present the AnimatedCluster strategy for OpenLayers. Some time ago I created an <a title=\"Animated marker cluster strategy for OpenLayers\" href=\"//2012/08/19/animated-marker-cluster-strategy-for-openlayers.html\">AnimatedCluster strategy for OpenLayers</a> that extends the basic Cluster strategy,\nanimating cluster when user changes the zoom.</p>\n<p style=\"text-align: center;\"><a href=\"http://www.acuriousanimal.com/AnimatedCluster\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 491px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 63.951120162932796%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACqklEQVQozzWQ20/acBiG+zfvchdeGHeIS5YsuGTuoMm2bKg4Tm0RgZ4oKqf+Dj1BC7S0HAq0hYIyo0scZi557748ed/vIdypo4/BzfV8sYi8YDoJp8tl2BkNZ0HQ8zx94N6swmDZN8euZPeBbTctq2H14OTSj/pE/kKlRbSMhsaoEQTOKpwNxq6o6VWb5U22JGvz0BX72SRkSma6hKVUE6clSXJr9hATAkJlXF+vxmicn3j2wJcpRRC0rj6UcqpIAowtsyDLJGzQKldASABC3cBBf9jXDgnOvMJjdjWfRuEk8md9v1mzxQvlahVOnNE4h2AGAArCTUigFmBl1n5uoG/rRGyRjxFFVWMVJfAnUej7gTvxB5EHo9azxbgSzty60SYlSP+DIcgjaBr0SPjxO7UXVgsEq6kpSW6b52vrfderqBPOcdtDq7hyj6at7YaGOKjlHmsxDVAKq82K+BB/dU19XPCnj3BSknWTuRt8mrqK54zmgTcLloopNsA+CaXHzUCm9TypFRgsh+qBw+4Pya/38ZcbWMtIzYJqDN3GjbkVOtyt87ZnMTwuedpWCfJZKFMA0QpHqiIPm1H3xdQTZFNT6+cEo2kkABmASvjStxMdu6mgPagINbShPlOoSUJEQZAFcg7IRqsXdHBkacBnrYX52JwFYKMkI8GSbvdANUzsWSLntbZ1fMxAg0Qb21Ie6rpyuGrt3qVj9+SHqHa25n8+wZvHaACSCF0K1O3JG4d753RPRrXiMv76is2mN86AUsUZSz+es6k5932d2/8T3yFYXacQojF+iiyfSdBtxa4HB0uVf0juGlWaNMs5DLJIo2STaemeuRMZXxbdDsFAeMxxvwTh9H+OyhW+WjXAWU96YYKi3lZKavy0zGxOCYE/4YVi+bBWzeGG8RceAHQncVcMrQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"anim cluster 212\" title=\"anim_cluster_212\" src=\"/static/99b77975e6572caeaaff6c1247689f7a/3bb78/anim_cluster_212.png\" srcset=\"/static/99b77975e6572caeaaff6c1247689f7a/19bd1/anim_cluster_212.png 163w,\n/static/99b77975e6572caeaaff6c1247689f7a/d3bcb/anim_cluster_212.png 325w,\n/static/99b77975e6572caeaaff6c1247689f7a/3bb78/anim_cluster_212.png 491w\" sizes=\"(max-width: 491px) 100vw, 491px\" loading=\"lazy\">\n    </span></a></p>\n<p>The problem with the previous version is the code makes some computations for all the clusters, no matter if they are inside or outside the map's viewport.</p>\n<h2>The problem</h2>\n<p>This issues is clearly reproducible in the old version. Zoom in until cluster contains one or two features and you will see a degradation of the animation.</p>\n<p>Now, compare with the <a href=\"http://www.acuriousanimal.com/AnimatedCluster\">new improved version</a>, which supports 50.000 features without problem (at least on my computer :) ).</p>\n<h2>How do I improve it?</h2>\n<p>The solution was easy, only manage the animation of those clusters inside the map's viewport:</p>\n<p>{% highlight javascript %}\nfor(var i=0; i&#x3C;this.features.length; ++i) {\nfeature = this.features[i];</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">// Check if the feature&#39;s geometry is on the map&#39;s viewport,\n// if so then manages it, otherwise ignore.\nif(this.layer &amp;&amp; this.layer.map) {\n    var screenBounds = this.layer.map.getExtent();\n    var featureBounds = feature.geometry.getBounds();\n    if(!screenBounds.intersectsBounds(featureBounds)) {\n        continue;\n    }\n}\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>}\n{% endhighlight %}</p>\n<p>Yes, it can seem obvious, but I have needed some time before I realized about this fact (dummy?)</p>\n<h2>References</h2>\n<ul>\n<li>GitHub source code <a href=\"https://github.com/acanimal/AnimatedCluster\">here</a></li>\n<li>GitHub demo source code <a href=\"http://www.acuriousanimal.com/AnimatedCluster/\">here</a></li>\n</ul>","excerpt":"Yes, now I'm really proud to present the AnimatedCluster strategy for OpenLayers. Some time ago I created an AnimatedCluster strategy for OpenLayers that extends the basic Cluster strategy,\n  animating cluster when user changes the zoom. {% highlight javascript %}\nfor(var i=0; i<this.features.length; ++i) {\n    feature = this.featuresi; }\n{% endhighlight %}","frontmatter":{"date":"09 October, 2012","title":"Improved performance on the AnimatedCluster for OpenLayers"},"fields":{"slug":"/blog/2012/10/09/improved-performance-on-the-animatedcluster-for-openlayers/","readingTime":{"text":"2 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2012/10/09/improved-performance-on-the-animatedcluster-for-openlayers/"}}}