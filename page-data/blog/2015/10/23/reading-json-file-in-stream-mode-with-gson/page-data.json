{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2015/10/23/reading-json-file-in-stream-mode-with-gson","webpackCompilationHash":"024410ebbb7cbeb2ff5b","result":{"data":{"markdownRemark":{"html":"<p>JSON is everywhere, it is the new fashion file format (see you XML). JSON format is mainly used on REST APIs because it is easy to read by JavaScript  (JSON means JavaScript Object Notation) allowing to develop client side application. In Java and, similarly to the old days of XML, we have different ways to read JSON files: object model or streaming way. No one is better than other, they are simply designed for different needs and situations.</p>\n<p>The object model way works loading the whole file in memory and translating each JavaScript object to a Java object containing all the properties, array objects, etc. It is similar to the DOM way to read XML files.</p>\n<p>On the other hand, the stream way reads the file <em>byte by byte</em> and allows to apply actions when an object starts, an array ends, etc. It is similar to SAX way to read XML files.</p>\n<p>There is a third way to read a JSON file, similarly to StAX with XML, that combines the streaming way to read with the object model. For example, we can read a file in stream mode and when found an object start then read the whole object into memory.</p>\n<p>Which method is better depends on your needs. If your JSON is small the object model is great because you can load all the data and work as a normal Java objects, searching within an array, iterating, etc. When the file is really big you'll probably don't want to load it all into memory, so the streaming model is the best choice.</p>\n<h3>The scene</h3>\n<p>We are working on an API implemented in Java and one of the operations requires to open a big JSON file (about 10Mb) an returns an object identified by a given string. The file in question is formed by an array of objects, tons of object, and it has no sense to read the whole file and create tons of Java objects into memory only to return one.</p>\n<p>So, this is a good scenario to read the JSON file in stream mode.</p>\n<h3>The code</h3>\n<p>Before to continue it is worth to mention the code you will see here is available at <a href=\"https://github.com/acanimal/java-json-examples\">java-json-examples</a> repository.</p>\n<p>I have generated a 2.5MB JSON file using the <a href=\"http://experiments.mennovanslooten.nl/2010/mockjson/tryit.html\">mockjson</a> tool. The data file is formed by an array ob <em>person</em> objects. Each <em>person</em> has an <code class=\"language-text\">id</code>, <code class=\"language-text\">name</code>, a <code class=\"language-text\">married</code> status and a list of <code class=\"language-text\">sons</code> and <code class=\"language-text\">daughters</code>:</p>\n<p>{% highlight json %}\n[\n{\n\"id\" : 0,\n\"married\" : true,\n\"name\" : \"George Moore\",\n\"sons\" : null,\n\"daughters\" : [\n{\n\"age\" : 25,\n\"name\" : \"Elizabeth\"\n},\n{\n\"age\" : 28,\n\"name\" : \"Nancy\"\n},\n{\n\"age\" : 9,\n\"name\" : \"Sandra\"\n}\n]\n},\n...\n]\n{% endhighlight %}</p>\n<h3>GSON</h3>\n<p>We are using <a href=\"https://en.wikipedia.org/wiki/Gson\">GSON</a> to read JSON files in Java. Take a look to the wikipedia link so you can see some of its main features.</p>\n<blockquote>\n<p>The other one great library to work with JSON data is Jackson. Both have similar features and performance.</p>\n</blockquote>\n<h3>Our <code class=\"language-text\">Person</code> model class</h3>\n<p>When GSON reads JSON data it allows to unmarshal it to a given Java class. For this purpose we have created the <code class=\"language-text\">Person</code> class which will store all the previous information (for the sample we are only stoting the person <code class=\"language-text\">id</code> and <code class=\"language-text\">name</code>):</p>\n<p>{% highlight java %}\npublic class Person {\nprivate int id;\nprivate String name;</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">// Getter/Setter methods\n...\n\n@Override\npublic String toString() {\n    return &quot;Person{&quot; + &quot;id=&quot; + id + &quot;, name=&quot; + name + &#39;}&#39;;\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>}\n{% endhighlight %}</p>\n<h4>Reading using object model</h4>\n<p>Next code shows how to read the JSON file using the object model. Remember, we are loading the whole file in memory converting data to <code class=\"language-text\">Person</code> java class.</p>\n<p>{% highlight java %}\npublic static void readDom() {\nBufferedReader reader = null;\ntry {\nreader = new BufferedReader(new FileReader(file));\nGson gson = new GsonBuilder().create();\nPerson[] people = gson.fromJson(reader, Person[].class);</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    System.out.println(&quot;Object mode: &quot; + people[0]);\n\n} catch (FileNotFoundException ex) {\n    ...\n} finally {\n    ...\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>}\n{% endhighlight %}</p>\n<p>The magic occurs within the line: <code class=\"language-text\">Person[] people = gson.fromJson(reader, Person[].class);</code>. We are telling GSON to read the file and return an array of <code class=\"language-text\">Person</code> objects.</p>\n<p>From here, if we want to return a given person we need to find it within the array. Let's take a look how we can do the same using the stream mode.</p>\n<h4>Reading using the stream mode</h4>\n<p>What we really are going to do here is to use a mixed mode between stream and object model. We are going to read file in stream mode and each time we found the start of a person object we are going to unmarshal it using the object model and we will repeat the process until we found the desired object.</p>\n<p>{% highlight java %}\npublic static void readStream() {\ntry {\nJsonReader reader = new JsonReader(new InputStreamReader(stream, \"UTF-8\"));\nGson gson = new GsonBuilder().create();</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    // Read file in stream mode\n    reader.beginArray();\n    while (reader.hasNext()) {\n        // Read data into object model\n        Person person = gson.fromJson(reader, Person.class);\n        if (person.getId() == 0 ) {\n            System.out.println(&quot;Stream mode: &quot; + person);\n        }\n        break;\n    }\n    reader.close();\n} catch (UnsupportedEncodingException ex) {\n    ...\n} catch (IOException ex) {\n    ...\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>}\n{% endhighlight %}</p>\n<p>With this approach we are loading all the objects to memory but one by one and not the whole file at once.</p>\n<h3>Conclusion</h3>\n<p>We have seen that JSON files, like XML, can be read with different techniques. Object model, stream mode or a mix of both. It is up to you to chose one depending on your needs.</p>\n<p>Object model allows to read a whole file and offers greater abstraction, because you can unmarshal data to your custom Java object model.</p>\n<p>Stream mode allows to read big files consuming fewer memory. As a cons, it implies a more <em>low level</em> reading but can be improved mixing both models (like in the example).</p>","excerpt":"JSON is everywhere, it is the new fashion file format (see you XML). JSON format is mainly used on REST APIs because it is easy to read by JavaScript  (JSON means JavaScript Object Notation) allowing to develop client side application. In Java and, similarly to the old days of XML, we have different ways to read JSON files: object model or streaming way. No one is better than other, they are simply designed for different needs and situations. The object model way works loading the whole file in memory and translating each JavaScript object to a Java object containing all the properties, array objects, etc. It is similar to the DOM way to read XML files. On the other hand, the stream way reads the file byte by byte and allows to apply actions when an object starts, an array ends, etc. It is similar to SAX way to read XML files. There is a third way to read a JSON file, similarly to StAX with XML, that combines the streaming way to read with the object model. For example, we can read a file in stream mode and when found an object start then read the whole object into memory. Which method is better depends on your needs. If your JSON is small the object model is great because you can load all the data and work as a normal Java objects, searching within an array, iterating, etc. When the file is really big you'll probably don't want to load it all into memory, so the streaming model is the best choice. The scene We are working on an API implemented in Java and one of the operations requires to open a big JSON file (about 10Mb) an returns an object identified by a given string. The file in question is formed by an array of objects, tons of object, and it has no sense to read the whole file and create tons of Java objects into memory only to return one. So, this is a good scenario to read the JSON file in stream mode. The code Before to continue it is worth to mention the code you will see here is available at java-json-examples repository. I have generated a 2.5MB JSON file using the mockjson tool. The data file is formed by an array ob person objects. Each person has an , , a  status and a list of  and : {% highlight json %}\n[\n  {\n    \"id\" : 0,\n    \"married\" : true,\n    \"name\" : \"George Moore\",\n    \"sons\" : null,\n    \"daughters\" : \n      {\n        \"age\" : 25,\n        \"name\" : \"Elizabeth\"\n      },\n      {\n        \"age\" : 28,\n        \"name\" : \"Nancy\"\n      },\n      {\n        \"age\" : 9,\n        \"name\" : \"Sandra\"\n      }\n    \n  },\n  ...\n]\n{% endhighlight %} GSON We are using GSON to read JSON files in Java. Take a look to the wikipedia link so you can see some of its main features. The other one great library to work with JSON data is Jackson. Both have similar features and performance. Our  model class When GSON reads JSON data it allows to unmarshal it to a given Java class. For this purpose we have created the  class which will store all the previous information (for the sample we are only stoting the person  and ): {% highlight java %}\npublic class Person {\n    private int id;\n    private String name; }\n{% endhighlight %} Reading using object model Next code shows how to read the JSON file using the object model. Remember, we are loading the whole file in memory converting data to  java class. {% highlight java %}\npublic static void readDom() {\n    BufferedReader reader = null;\n    try {\n        reader = new BufferedReader(new FileReader(file));\n        Gson gson = new GsonBuilder().create();\n        Person[] people = gson.fromJson(reader, Person[].class); }\n{% endhighlight %} The magic occurs within the line: . We are telling GSON to read the file and return an array of  objects. From here, if we want to return a given person we need to find it within the array. Let's take a look how we can do the same using the stream mode. Reading using the stream mode What we really are going to do here is to use a mixed mode between stream and object model. We are going to read file in stream mode and each time we found the start of a person object we are going to unmarshal it using the object model and we will repeat the process until we found the desired object. {% highlight java %}\npublic static void readStream() {\n    try {\n        JsonReader reader = new JsonReader(new InputStreamReader(stream, \"UTF-8\"));\n        Gson gson = new GsonBuilder().create(); }\n{% endhighlight %} With this approach we are loading all the objects to memory but one by one and not the whole file at once. Conclusion We have seen that JSON files, like XML, can be read with different techniques. Object model, stream mode or a mix of both. It is up to you to chose one depending on your needs. Object model allows to read a whole file and offers greater abstraction, because you can unmarshal data to your custom Java object model. Stream mode allows to read big files consuming fewer memory. As a cons, it implies a more low level reading but can be improved mixing both models (like in the example).","frontmatter":{"date":"23 October, 2015","title":"Reading very big JSON files in stream mode with GSON"},"fields":{"slug":"/blog/2015/10/23/reading-json-file-in-stream-mode-with-gson","readingTime":{"text":"5 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2015/10/23/reading-json-file-in-stream-mode-with-gson"}}}