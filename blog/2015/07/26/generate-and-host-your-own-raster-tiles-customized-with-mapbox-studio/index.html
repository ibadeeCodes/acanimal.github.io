<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.4f92695be72627e33446.css">code[class*=language-],pre[class*=language-]{color:#c5c8c6;text-shadow:0 1px rgba(0,0,0,.3);font-family:Inconsolata,Monaco,Consolas,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#1d1f21}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#7c7c7c}.token.punctuation{color:#c5c8c6}.namespace{opacity:.7}.token.keyword,.token.property,.token.tag{color:#96cbfe}.token.class-name{color:#ffffb6;text-decoration:underline}.token.boolean,.token.constant{color:#9c9}.token.deleted,.token.symbol{color:#f92672}.token.number{color:#ff73fd}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a8ff60}.token.variable{color:#c6c5fe}.token.operator{color:#ededed}.token.entity{color:#ffffb6}.token.url{color:#96cbfe}.language-css .token.string,.style .token.string{color:#87c38a}.token.atrule,.token.attr-value{color:#f9ee98}.token.function{color:#dad085}.token.regex{color:#e9c062}.token.important{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:200;src:local("Nunito Extra Light "),local("Nunito-Extra Light"),url(/static/nunito-latin-200-2a4f4b0a3646be9d8560178ebc4306e5.woff2) format("woff2"),url(/static/nunito-latin-200-249c20ee4450b15795cdde4cbb5f38d8.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:200;src:local("Nunito Extra Light italic"),local("Nunito-Extra Lightitalic"),url(/static/nunito-latin-200italic-89ba5530f3b2c751f2a49e25f31e3f15.woff2) format("woff2"),url(/static/nunito-latin-200italic-67d3d63c0ac28ccbc0c0fcbda8e66e04.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:300;src:local("Nunito Light "),local("Nunito-Light"),url(/static/nunito-latin-300-895205e22ad7d4d866df7102352077cd.woff2) format("woff2"),url(/static/nunito-latin-300-cad1324b066f52f764cf080d9244c8b2.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:300;src:local("Nunito Light italic"),local("Nunito-Lightitalic"),url(/static/nunito-latin-300italic-f4a613c73f19da60cf08aa42b2a9249b.woff2) format("woff2"),url(/static/nunito-latin-300italic-1fde36925a8493f45651815dd89d22a7.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:400;src:local("Nunito Regular "),local("Nunito-Regular"),url(/static/nunito-latin-400-de6068bf97f40206af0b062e262e6213.woff2) format("woff2"),url(/static/nunito-latin-400-6386ba6af7b7a5480eb5efda82ff803c.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:400;src:local("Nunito Regular italic"),local("Nunito-Regularitalic"),url(/static/nunito-latin-400italic-6ca737afe5cef0c0a9c9bbfec4e398ff.woff2) format("woff2"),url(/static/nunito-latin-400italic-ef2e2a0d9dd85cf89526d1f27f8fbbef.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:600;src:local("Nunito SemiBold "),local("Nunito-SemiBold"),url(/static/nunito-latin-600-b10ecee279e3a8d11d5ec3193b68d8bf.woff2) format("woff2"),url(/static/nunito-latin-600-c3de23017bcb95715e6eb11dd6a10fc5.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:600;src:local("Nunito SemiBold italic"),local("Nunito-SemiBolditalic"),url(/static/nunito-latin-600italic-97d4f64b213f3e5163827754c213bb4e.woff2) format("woff2"),url(/static/nunito-latin-600italic-4f62b81ff327bd0ffadcb7b82e6c13b2.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:700;src:local("Nunito Bold "),local("Nunito-Bold"),url(/static/nunito-latin-700-91ae827aa880d02ea567979add1da58c.woff2) format("woff2"),url(/static/nunito-latin-700-623f5ed42b0b347fb4531ded4e4b57a2.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:700;src:local("Nunito Bold italic"),local("Nunito-Bolditalic"),url(/static/nunito-latin-700italic-b94caac4c88b1fe6c4faf6256646f42e.woff2) format("woff2"),url(/static/nunito-latin-700italic-3aabf345871453097c2d8762411d187e.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:800;src:local("Nunito ExtraBold "),local("Nunito-ExtraBold"),url(/static/nunito-latin-800-36e4c9b478c2e2adb339a76d819eed7e.woff2) format("woff2"),url(/static/nunito-latin-800-33c733aff58ea08126616f346cbf4f4a.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:800;src:local("Nunito ExtraBold italic"),local("Nunito-ExtraBolditalic"),url(/static/nunito-latin-800italic-0f20328772c0d84250ef397c129607fb.woff2) format("woff2"),url(/static/nunito-latin-800italic-672d2afe4f40a766e46ff95379550c4f.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:900;src:local("Nunito Black "),local("Nunito-Black"),url(/static/nunito-latin-900-b296e05d0932e16d500b753becdb338e.woff2) format("woff2"),url(/static/nunito-latin-900-cbf4339e858edf2b14d20140b2887343.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:900;src:local("Nunito Black italic"),local("Nunito-Blackitalic"),url(/static/nunito-latin-900italic-ae87e7b4e2d3825919b9bc6c82039b80.woff2) format("woff2"),url(/static/nunito-latin-900italic-602859bd469800c6205701f5a16b1a1b.woff) format("woff")}#___gatsby,#gatsby-focus-wrapper,body,html{width:100%;height:100%;margin:0;font-family:Nunito,Avenir,Helvetica,"sans-serif";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{font-style:normal;color:rgba(0,0,0,.8);-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code{background-color:rgba(0,0,0,.04)}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.8rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{margin:1rem;padding:1rem;border-radius:1rem;background-color:#eee}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.8rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}.gatsby-highlight{background-color:#1d1f21;border-radius:.3em;margin:.5em 0;padding:1em;overflow:auto}.gatsby-highlight pre[class*=language-].line-numbers{padding:0 0 0 2.8em;overflow:initial;white-space:pre-wrap}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.13.14"/><title data-react-helmet="true">Generate and host your own raster tiles customized with Mapbox Studio | A Curious Animal</title><meta data-react-helmet="true" name="description" content="If you have never saw maps hosted in Mapbox platform you would probably agree on the quality of its designs. The business of Mapbox is to host and server geospatial data. For this reason, all the great tools Mapbox facilitates are oriented to help their users to prepare and work with their data. One of the provided tools is Mapbox Studio. Mapbox Studio (MbS) is a desktop application that allows to create CartoCSS themes that are later used to generate raster tiles. Briefly explained, what MbS does is to download OpenStreetMap data in vector format and render it on the fly applying the specified CartoCSS style. The result of working with MbS is not a set of tiles but a style, that is, a set of rules that express which colour must be used to render roads, at which levels must labels appears and with which size, which colour must be used for ground, etc. This style can be later uploaded to Mapbox platform so that raster tiles were generated on the cloud and we can consume the tiles paying for the service. (Hope one day I can contract their services, they deserve by their great job). The question we can make us is: how we can generate the raster tiles locally from a given MbS style? Well, this article is about that. Continue reading. Working with Mapbox Studio and create your custom style Let&#x27;s start from the beginning so download Mapbox Studio application and install on your system. Once installed execute it and you will be asked to be connected to the Mapbox platform. There are two main reasons why Mapbox requires you to register as a user. First, the power of the platform is on the cloud and the goal is you upload all your data to the servers. That includes the styles you create. Second, MbS retrieves data in vector format from Mapbox servers. When you register as a user you get an API token that identifies your requests. Each time MbS makes a request to extract data it has your token that identifies you as user. This way Mapbox can control if any user is making a bad usage of their platform.  Once logged in you will be allowed to create new map styles. The easiest way is to start using one of the starter styles created by the great Mapbox designers:  Here we have chose the Mapbox Outdoors style. In the image you can see the style code (CartoCSS which is inspered by CSS) and the resultant tiles obtaining from painting the vector information with the given style rules: CartoCSS is a Mapnik stylesheet pre-processor developed by MapBox and inspired by Cascadenik. It is like a CSS language specially developed to style maps.  Store the style with a new name somewhere on your computer, for example, . If you look at your disk you will see a  folder has been created containing a bunch of files that defines the style rules (take a look they are not dangerous). Finally, modify some properties, for example  or  colors and save to see the result:  Great !!! You just have created your first custom style. Generating raster tiles from MbS style Looking for a solution I discovered the tessera and tl tools. Tessera is a node based command line application. It is based in some modules from mapbox (concretely tilelive) plus others implemented by the author (Seth Fitzsimmons). The result is we can execute tessera passing a MbS defined style, open a browser pointing to a local address and see a map with the raster tiles generated with our MbS style. Similarly, tl is a node based command line tool we can execute, passing a set of options, to generate a MBTiles file or a pyramid of tiles following the well known  format. I know about both tools at the article Converting Mapbox Studio Vector Tiles to Rasters from Azavea Labs. How to install the tools? NOTE: You need to have NodeJS installed in your system, along with the npm package manager command line tools. I don&#x27;t like to install global node packages (or at least more than the necessary) so I&#x27;m going to install the previous tools in a custom folder: {% highlight bash %} mkdir tiletools
cd tiletools
{% endhighlight %} Inside the directory execute next sentence, which install the  and  packages among others: {% highlight bash %} npm install tessera tl mbtiles mapnik tilelive tilelive-file tilelive-http tilelive-mapbox tilelive-mapnik tilelive-s3 tilelive-tmsource tilelive-tmstyle tilelive-utfgrid tilelive-vector tilejson
{% endhighlight %} You will see a hidden directory named  has been created which contains some subdirectories with the same name as the previous packages. Running tessera Let&#x27;s try to run tessera for the first time. Because it is installed as a local node module execute: {% highlight bash %} ./node_modules/tessera/bin/tessera.js Usage: node tessera.js uri options uri     tilelive URI to serve Options:
   -C SIZE, --cache-size SIZE          Set the cache size (in MB)  10
   -c CONFIG, --config CONFIG          Provide a configuration file
   -p PORT, --port PORT                Set the HTTP Port  8080
   -r MODULE, --require MODULE         Require a specific tilelive module
   -S SIZE, --source-cache-size SIZE   Set the source cache size (in # of sources)  10
   -v, --version                       Show version info A tilelive URI or configuration file is required.
{% endhighlight %} Tessera requires you pass an URI so it can server its content. It accepts URIs from Mapbox hosted file, Mapnik, Tilemill, Mapbox Studio, ... Repeat again indicating the path to our previously created style indicating the protocol . {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/nodemodules/tessera/server.js:43
        throw err;
              ^
Error: A Mapbox access accessToken is required. `export MAPBOXACCESS_TOKEN=...` to set.
...
{% endhighlight %} First seems tessera is working at port 8080 but later we get an error about . If you remember from the first section, Mapbox requires all the requests be signed with the user token. So, you need to get the access token from your account and set it as environment variable before execute tessera: {% highlight bash %} export MAPBOXACCESSTOKEN=yourtokenhere
./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Open Sans Bold&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} We are close to make it work. The problem now is our MbS style is using a font we have not installed in our system. One easy, but brute force, solution is to install all Google Web Fonts on your system. For this purpose you can use the Web Font Load installation script. In my case I have installed them in the user&#x27;s fonts folder . Once fonts were installed try executing tessera again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Open Sans Bold&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} That&#x27; s a bit strange, we have just installed the fonts but they are not found. What is happening? Well, tessera uses mapnik to create the raster tiles and it looks for fonts in the folders specified by the environment variable , so let define the variable: {% highlight bash %} export MAPNIKFONTPATH=~/Library/Fonts/
{% endhighlight %} and execute the script again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Arial Unicode MS Regular&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} OMG !!! This seems a never ending story. Now we need to install the Arial Unicode font. Look for it, install in your system and execute tessera again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/
{% endhighlight %} Great !!! It seems tessera is working fine. Let&#x27;s go to open our browser pointing to  and see the result:  A map implemented using Leaflet web mapping library is shown, rendering raster tiles that are created in the fly. Look at the console to see the tessera output information:  We can see how tiles at current zoom, the zoom level 8, has been generated. At this point we have tessera working but what about generate a local pyramid of tiles for a given zoom levels and a given bounding box? Generating a custom pyramid of tiles with tl command line tool Before continue we need to know which bounding box we want to generate, the whole World? or only a piece. In my case I want three zoom levels (7, 8 and 9) wrapping Catalonia. There are some online tools you can use to get the bbox of a region, but one I like it the Bounding Box Tool from Klokan Technologies. The tl tool can run three main commands but are only interested in the copy one, which copies data between two providers. In our case the MbS style is one provider and the file system is the other. Run the tl command to see the available options: {% highlight bash %} ./node_modules/tl/bin/tl.js copy --help Usage: node tl.js copy   options source     source URI
sink       sink URI Options:
   -v, --version                 Show version info
   -b BBOX, --bounds BBOX        WGS84 bounding box  -180,-85.0511,180,85.0511
   -z ZOOM, --min-zoom ZOOM      Min zoom (inclusive)  0
   -Z ZOOM, --max-zoom ZOOM      Max zoom (inclusive)  22
   -r MODULE, --require MODULE   Require a specific tilelive module
   -s SCHEME, --scheme SCHEME    Copy scheme  scanline
   -i FILE, --info FILE          TileJSON copy data between tilelive providers
{% endhighlight %} So let&#x27;s go to execute the command to copy data from our MbS style to the local  folder. We want to generate tiles from zoom level 7 to 9 and indicating a bounding box wrapping Catalonia. Remember the  options must be indicated as . {% highlight bash %} ./node_modules/tl/bin/tl.js copy -z 7 -Z 9 -b &quot;0.023293972 40.4104003077 3.6146087646 42.9542303723&quot; tmstyle://./customstyle.tm2/ file://./tiles
Segmentation fault: 11
{% endhighlight %} Ough !!! That hurts, a segmentation fault. After looking for a while I realised it seems a bug. To solve it go to  and remove the  folder dependency. It is redundant because there is one installed in parent folder. Execute the command again and see the output:  The tl tool has created a local tiles directory and generated all the raster tiles for the given zoom levels and bounding box. The output shows in addition the time required to generate each tile. That&#x27;s all. Now we only need to host the tiles at our own servers !!!"/><meta data-react-helmet="true" property="og:title" content="Generate and host your own raster tiles customized with Mapbox Studio"/><meta data-react-helmet="true" property="og:description" content="If you have never saw maps hosted in Mapbox platform you would probably agree on the quality of its designs. The business of Mapbox is to host and server geospatial data. For this reason, all the great tools Mapbox facilitates are oriented to help their users to prepare and work with their data. One of the provided tools is Mapbox Studio. Mapbox Studio (MbS) is a desktop application that allows to create CartoCSS themes that are later used to generate raster tiles. Briefly explained, what MbS does is to download OpenStreetMap data in vector format and render it on the fly applying the specified CartoCSS style. The result of working with MbS is not a set of tiles but a style, that is, a set of rules that express which colour must be used to render roads, at which levels must labels appears and with which size, which colour must be used for ground, etc. This style can be later uploaded to Mapbox platform so that raster tiles were generated on the cloud and we can consume the tiles paying for the service. (Hope one day I can contract their services, they deserve by their great job). The question we can make us is: how we can generate the raster tiles locally from a given MbS style? Well, this article is about that. Continue reading. Working with Mapbox Studio and create your custom style Let&#x27;s start from the beginning so download Mapbox Studio application and install on your system. Once installed execute it and you will be asked to be connected to the Mapbox platform. There are two main reasons why Mapbox requires you to register as a user. First, the power of the platform is on the cloud and the goal is you upload all your data to the servers. That includes the styles you create. Second, MbS retrieves data in vector format from Mapbox servers. When you register as a user you get an API token that identifies your requests. Each time MbS makes a request to extract data it has your token that identifies you as user. This way Mapbox can control if any user is making a bad usage of their platform.  Once logged in you will be allowed to create new map styles. The easiest way is to start using one of the starter styles created by the great Mapbox designers:  Here we have chose the Mapbox Outdoors style. In the image you can see the style code (CartoCSS which is inspered by CSS) and the resultant tiles obtaining from painting the vector information with the given style rules: CartoCSS is a Mapnik stylesheet pre-processor developed by MapBox and inspired by Cascadenik. It is like a CSS language specially developed to style maps.  Store the style with a new name somewhere on your computer, for example, . If you look at your disk you will see a  folder has been created containing a bunch of files that defines the style rules (take a look they are not dangerous). Finally, modify some properties, for example  or  colors and save to see the result:  Great !!! You just have created your first custom style. Generating raster tiles from MbS style Looking for a solution I discovered the tessera and tl tools. Tessera is a node based command line application. It is based in some modules from mapbox (concretely tilelive) plus others implemented by the author (Seth Fitzsimmons). The result is we can execute tessera passing a MbS defined style, open a browser pointing to a local address and see a map with the raster tiles generated with our MbS style. Similarly, tl is a node based command line tool we can execute, passing a set of options, to generate a MBTiles file or a pyramid of tiles following the well known  format. I know about both tools at the article Converting Mapbox Studio Vector Tiles to Rasters from Azavea Labs. How to install the tools? NOTE: You need to have NodeJS installed in your system, along with the npm package manager command line tools. I don&#x27;t like to install global node packages (or at least more than the necessary) so I&#x27;m going to install the previous tools in a custom folder: {% highlight bash %} mkdir tiletools
cd tiletools
{% endhighlight %} Inside the directory execute next sentence, which install the  and  packages among others: {% highlight bash %} npm install tessera tl mbtiles mapnik tilelive tilelive-file tilelive-http tilelive-mapbox tilelive-mapnik tilelive-s3 tilelive-tmsource tilelive-tmstyle tilelive-utfgrid tilelive-vector tilejson
{% endhighlight %} You will see a hidden directory named  has been created which contains some subdirectories with the same name as the previous packages. Running tessera Let&#x27;s try to run tessera for the first time. Because it is installed as a local node module execute: {% highlight bash %} ./node_modules/tessera/bin/tessera.js Usage: node tessera.js uri options uri     tilelive URI to serve Options:
   -C SIZE, --cache-size SIZE          Set the cache size (in MB)  10
   -c CONFIG, --config CONFIG          Provide a configuration file
   -p PORT, --port PORT                Set the HTTP Port  8080
   -r MODULE, --require MODULE         Require a specific tilelive module
   -S SIZE, --source-cache-size SIZE   Set the source cache size (in # of sources)  10
   -v, --version                       Show version info A tilelive URI or configuration file is required.
{% endhighlight %} Tessera requires you pass an URI so it can server its content. It accepts URIs from Mapbox hosted file, Mapnik, Tilemill, Mapbox Studio, ... Repeat again indicating the path to our previously created style indicating the protocol . {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/nodemodules/tessera/server.js:43
        throw err;
              ^
Error: A Mapbox access accessToken is required. `export MAPBOXACCESS_TOKEN=...` to set.
...
{% endhighlight %} First seems tessera is working at port 8080 but later we get an error about . If you remember from the first section, Mapbox requires all the requests be signed with the user token. So, you need to get the access token from your account and set it as environment variable before execute tessera: {% highlight bash %} export MAPBOXACCESSTOKEN=yourtokenhere
./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Open Sans Bold&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} We are close to make it work. The problem now is our MbS style is using a font we have not installed in our system. One easy, but brute force, solution is to install all Google Web Fonts on your system. For this purpose you can use the Web Font Load installation script. In my case I have installed them in the user&#x27;s fonts folder . Once fonts were installed try executing tessera again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Open Sans Bold&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} That&#x27; s a bit strange, we have just installed the fonts but they are not found. What is happening? Well, tessera uses mapnik to create the raster tiles and it looks for fonts in the folders specified by the environment variable , so let define the variable: {% highlight bash %} export MAPNIKFONTPATH=~/Library/Fonts/
{% endhighlight %} and execute the script again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Arial Unicode MS Regular&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} OMG !!! This seems a never ending story. Now we need to install the Arial Unicode font. Look for it, install in your system and execute tessera again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/
{% endhighlight %} Great !!! It seems tessera is working fine. Let&#x27;s go to open our browser pointing to  and see the result:  A map implemented using Leaflet web mapping library is shown, rendering raster tiles that are created in the fly. Look at the console to see the tessera output information:  We can see how tiles at current zoom, the zoom level 8, has been generated. At this point we have tessera working but what about generate a local pyramid of tiles for a given zoom levels and a given bounding box? Generating a custom pyramid of tiles with tl command line tool Before continue we need to know which bounding box we want to generate, the whole World? or only a piece. In my case I want three zoom levels (7, 8 and 9) wrapping Catalonia. There are some online tools you can use to get the bbox of a region, but one I like it the Bounding Box Tool from Klokan Technologies. The tl tool can run three main commands but are only interested in the copy one, which copies data between two providers. In our case the MbS style is one provider and the file system is the other. Run the tl command to see the available options: {% highlight bash %} ./node_modules/tl/bin/tl.js copy --help Usage: node tl.js copy   options source     source URI
sink       sink URI Options:
   -v, --version                 Show version info
   -b BBOX, --bounds BBOX        WGS84 bounding box  -180,-85.0511,180,85.0511
   -z ZOOM, --min-zoom ZOOM      Min zoom (inclusive)  0
   -Z ZOOM, --max-zoom ZOOM      Max zoom (inclusive)  22
   -r MODULE, --require MODULE   Require a specific tilelive module
   -s SCHEME, --scheme SCHEME    Copy scheme  scanline
   -i FILE, --info FILE          TileJSON copy data between tilelive providers
{% endhighlight %} So let&#x27;s go to execute the command to copy data from our MbS style to the local  folder. We want to generate tiles from zoom level 7 to 9 and indicating a bounding box wrapping Catalonia. Remember the  options must be indicated as . {% highlight bash %} ./node_modules/tl/bin/tl.js copy -z 7 -Z 9 -b &quot;0.023293972 40.4104003077 3.6146087646 42.9542303723&quot; tmstyle://./customstyle.tm2/ file://./tiles
Segmentation fault: 11
{% endhighlight %} Ough !!! That hurts, a segmentation fault. After looking for a while I realised it seems a bug. To solve it go to  and remove the  folder dependency. It is redundant because there is one installed in parent folder. Execute the command again and see the output:  The tl tool has created a local tiles directory and generated all the raster tiles for the given zoom levels and bounding box. The output shows in addition the time required to generate each tile. That&#x27;s all. Now we only need to host the tiles at our own servers !!!"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@acanimal"/><meta data-react-helmet="true" name="twitter:title" content="Generate and host your own raster tiles customized with Mapbox Studio"/><meta data-react-helmet="true" name="twitter:description" content="If you have never saw maps hosted in Mapbox platform you would probably agree on the quality of its designs. The business of Mapbox is to host and server geospatial data. For this reason, all the great tools Mapbox facilitates are oriented to help their users to prepare and work with their data. One of the provided tools is Mapbox Studio. Mapbox Studio (MbS) is a desktop application that allows to create CartoCSS themes that are later used to generate raster tiles. Briefly explained, what MbS does is to download OpenStreetMap data in vector format and render it on the fly applying the specified CartoCSS style. The result of working with MbS is not a set of tiles but a style, that is, a set of rules that express which colour must be used to render roads, at which levels must labels appears and with which size, which colour must be used for ground, etc. This style can be later uploaded to Mapbox platform so that raster tiles were generated on the cloud and we can consume the tiles paying for the service. (Hope one day I can contract their services, they deserve by their great job). The question we can make us is: how we can generate the raster tiles locally from a given MbS style? Well, this article is about that. Continue reading. Working with Mapbox Studio and create your custom style Let&#x27;s start from the beginning so download Mapbox Studio application and install on your system. Once installed execute it and you will be asked to be connected to the Mapbox platform. There are two main reasons why Mapbox requires you to register as a user. First, the power of the platform is on the cloud and the goal is you upload all your data to the servers. That includes the styles you create. Second, MbS retrieves data in vector format from Mapbox servers. When you register as a user you get an API token that identifies your requests. Each time MbS makes a request to extract data it has your token that identifies you as user. This way Mapbox can control if any user is making a bad usage of their platform.  Once logged in you will be allowed to create new map styles. The easiest way is to start using one of the starter styles created by the great Mapbox designers:  Here we have chose the Mapbox Outdoors style. In the image you can see the style code (CartoCSS which is inspered by CSS) and the resultant tiles obtaining from painting the vector information with the given style rules: CartoCSS is a Mapnik stylesheet pre-processor developed by MapBox and inspired by Cascadenik. It is like a CSS language specially developed to style maps.  Store the style with a new name somewhere on your computer, for example, . If you look at your disk you will see a  folder has been created containing a bunch of files that defines the style rules (take a look they are not dangerous). Finally, modify some properties, for example  or  colors and save to see the result:  Great !!! You just have created your first custom style. Generating raster tiles from MbS style Looking for a solution I discovered the tessera and tl tools. Tessera is a node based command line application. It is based in some modules from mapbox (concretely tilelive) plus others implemented by the author (Seth Fitzsimmons). The result is we can execute tessera passing a MbS defined style, open a browser pointing to a local address and see a map with the raster tiles generated with our MbS style. Similarly, tl is a node based command line tool we can execute, passing a set of options, to generate a MBTiles file or a pyramid of tiles following the well known  format. I know about both tools at the article Converting Mapbox Studio Vector Tiles to Rasters from Azavea Labs. How to install the tools? NOTE: You need to have NodeJS installed in your system, along with the npm package manager command line tools. I don&#x27;t like to install global node packages (or at least more than the necessary) so I&#x27;m going to install the previous tools in a custom folder: {% highlight bash %} mkdir tiletools
cd tiletools
{% endhighlight %} Inside the directory execute next sentence, which install the  and  packages among others: {% highlight bash %} npm install tessera tl mbtiles mapnik tilelive tilelive-file tilelive-http tilelive-mapbox tilelive-mapnik tilelive-s3 tilelive-tmsource tilelive-tmstyle tilelive-utfgrid tilelive-vector tilejson
{% endhighlight %} You will see a hidden directory named  has been created which contains some subdirectories with the same name as the previous packages. Running tessera Let&#x27;s try to run tessera for the first time. Because it is installed as a local node module execute: {% highlight bash %} ./node_modules/tessera/bin/tessera.js Usage: node tessera.js uri options uri     tilelive URI to serve Options:
   -C SIZE, --cache-size SIZE          Set the cache size (in MB)  10
   -c CONFIG, --config CONFIG          Provide a configuration file
   -p PORT, --port PORT                Set the HTTP Port  8080
   -r MODULE, --require MODULE         Require a specific tilelive module
   -S SIZE, --source-cache-size SIZE   Set the source cache size (in # of sources)  10
   -v, --version                       Show version info A tilelive URI or configuration file is required.
{% endhighlight %} Tessera requires you pass an URI so it can server its content. It accepts URIs from Mapbox hosted file, Mapnik, Tilemill, Mapbox Studio, ... Repeat again indicating the path to our previously created style indicating the protocol . {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/nodemodules/tessera/server.js:43
        throw err;
              ^
Error: A Mapbox access accessToken is required. `export MAPBOXACCESS_TOKEN=...` to set.
...
{% endhighlight %} First seems tessera is working at port 8080 but later we get an error about . If you remember from the first section, Mapbox requires all the requests be signed with the user token. So, you need to get the access token from your account and set it as environment variable before execute tessera: {% highlight bash %} export MAPBOXACCESSTOKEN=yourtokenhere
./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Open Sans Bold&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} We are close to make it work. The problem now is our MbS style is using a font we have not installed in our system. One easy, but brute force, solution is to install all Google Web Fonts on your system. For this purpose you can use the Web Font Load installation script. In my case I have installed them in the user&#x27;s fonts folder . Once fonts were installed try executing tessera again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Open Sans Bold&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} That&#x27; s a bit strange, we have just installed the fonts but they are not found. What is happening? Well, tessera uses mapnik to create the raster tiles and it looks for fonts in the folders specified by the environment variable , so let define the variable: {% highlight bash %} export MAPNIKFONTPATH=~/Library/Fonts/
{% endhighlight %} and execute the script again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/ /Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
        throw err;
              ^
Error: Failed to find font face &#x27;Arial Unicode MS Regular&#x27; in FontSet &#x27;fontset-0&#x27; in FontSet
{% endhighlight %} OMG !!! This seems a never ending story. Now we need to install the Arial Unicode font. Look for it, install in your system and execute tessera again: {% highlight bash %} ./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at http://0.0.0.0:8080/
{% endhighlight %} Great !!! It seems tessera is working fine. Let&#x27;s go to open our browser pointing to  and see the result:  A map implemented using Leaflet web mapping library is shown, rendering raster tiles that are created in the fly. Look at the console to see the tessera output information:  We can see how tiles at current zoom, the zoom level 8, has been generated. At this point we have tessera working but what about generate a local pyramid of tiles for a given zoom levels and a given bounding box? Generating a custom pyramid of tiles with tl command line tool Before continue we need to know which bounding box we want to generate, the whole World? or only a piece. In my case I want three zoom levels (7, 8 and 9) wrapping Catalonia. There are some online tools you can use to get the bbox of a region, but one I like it the Bounding Box Tool from Klokan Technologies. The tl tool can run three main commands but are only interested in the copy one, which copies data between two providers. In our case the MbS style is one provider and the file system is the other. Run the tl command to see the available options: {% highlight bash %} ./node_modules/tl/bin/tl.js copy --help Usage: node tl.js copy   options source     source URI
sink       sink URI Options:
   -v, --version                 Show version info
   -b BBOX, --bounds BBOX        WGS84 bounding box  -180,-85.0511,180,85.0511
   -z ZOOM, --min-zoom ZOOM      Min zoom (inclusive)  0
   -Z ZOOM, --max-zoom ZOOM      Max zoom (inclusive)  22
   -r MODULE, --require MODULE   Require a specific tilelive module
   -s SCHEME, --scheme SCHEME    Copy scheme  scanline
   -i FILE, --info FILE          TileJSON copy data between tilelive providers
{% endhighlight %} So let&#x27;s go to execute the command to copy data from our MbS style to the local  folder. We want to generate tiles from zoom level 7 to 9 and indicating a bounding box wrapping Catalonia. Remember the  options must be indicated as . {% highlight bash %} ./node_modules/tl/bin/tl.js copy -z 7 -Z 9 -b &quot;0.023293972 40.4104003077 3.6146087646 42.9542303723&quot; tmstyle://./customstyle.tm2/ file://./tiles
Segmentation fault: 11
{% endhighlight %} Ough !!! That hurts, a segmentation fault. After looking for a while I realised it seems a bug. To solve it go to  and remove the  folder dependency. It is redundant because there is one installed in parent folder. Execute the command again and see the output:  The tl tool has created a local tiles directory and generated all the raster tiles for the given zoom levels and bounding box. The output shows in addition the time required to generate each tile. That&#x27;s all. Now we only need to host the tiles at our own servers !!!"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="shortcut icon" href="/icons/icon-48x48.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=78a6c6fcdb91be22537eb4a2256e5f2d"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="A Curious Animal" href="/rss.xml"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-617c46b3566c32bb10ba.js"/><link as="script" rel="preload" href="/1-78f6aee68644394c4f8a.js"/><link as="script" rel="preload" href="/app-23466d4bc1e9c7aa54ed.js"/><link as="script" rel="preload" href="/styles-577ae45e6d2a94e7a3f3.js"/><link as="script" rel="preload" href="/webpack-runtime-8d99c0c389af96d474b0.js"/><link as="fetch" rel="preload" href="/page-data/blog/2015/07/26/generate-and-host-your-own-raster-tiles-customized-with-mapbox-studio/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="1k8t7d9">.css-1k8t7d9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;height:100%;}</style><div class="css-1k8t7d9 egf89ri0"><style data-emotion-css="1hn1nns">.css-1hn1nns{background-color:#EEEEEE;background:url("https://unsplash.it/1500/500?random&blur") no-repeat center center fixed;background-size:cover;height:100%;}</style><header class="css-1hn1nns e5kaaa10"><style data-emotion-css="1yzdjlk">.css-1yzdjlk{padding:1rem 2rem;font-size:1.2rem;text-align:center;}</style><div class="css-1yzdjlk e5kaaa13"><style data-emotion-css="fb9rxi">.css-fb9rxi{color:black;margin-left:15px;-webkit-text-decoration:none;text-decoration:none;display:inline-block;position:relative;text-shadow:1px 1px 1px #FFFFFF;margin-left:0;}.css-fb9rxi::after{content:"";position:absolute;width:100%;-webkit-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);height:2px;bottom:0;left:0;background-color:rgba(0,0,0,0.8);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;-webkit-transition:-webkit-transform 0.4s cubic-bezier(0.86,0,0.07,1);-webkit-transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);}.css-fb9rxi:hover::after{-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;-ms-transform-origin:bottom left;transform-origin:bottom left;}</style><a class="css-fb9rxi e5kaaa15" href="/">Home</a><style data-emotion-css="s7vzln">.css-s7vzln{color:black;margin-left:15px;-webkit-text-decoration:none;text-decoration:none;display:inline-block;position:relative;text-shadow:1px 1px 1px #FFFFFF;}.css-s7vzln::after{content:"";position:absolute;width:100%;-webkit-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);height:2px;bottom:0;left:0;background-color:rgba(0,0,0,0.8);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;-webkit-transition:-webkit-transform 0.4s cubic-bezier(0.86,0,0.07,1);-webkit-transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);}.css-s7vzln:hover::after{-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;-ms-transform-origin:bottom left;transform-origin:bottom left;}</style><a class="css-s7vzln e5kaaa14" href="/blog">Blog</a><a class="css-s7vzln e5kaaa14" href="/digest">Digest</a><a class="css-s7vzln e5kaaa14" href="/books">Books</a><a class="css-s7vzln e5kaaa14" href="/projects">Projects</a><a class="css-s7vzln e5kaaa14" href="/archive">Archive</a><a class="css-s7vzln e5kaaa14" href="/about">About</a><style data-emotion-css="1r9gd80">.css-1r9gd80{position:absolute;top:20px;right:20px;}</style><a href="/rss.xml" class="css-1r9gd80 e5kaaa16"><style data-emotion-css="on3xa">.css-on3xa{width:20px;height:20px;margin-bottom:0;}</style><img alt="logo" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE2LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9IjQzNC4yMzlweCIgaGVpZ2h0PSI0MzQuMjM5cHgiIHZpZXdCb3g9IjAgMCA0MzQuMjM5IDQzNC4yMzkiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQzNC4yMzkgNDM0LjIzOTsiDQoJIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGc+DQoJPGc+DQoJCTxwYXRoIGQ9Ik04OS4xMzgsMzA2LjgxN2MtMjMuNjIzLTEwLjQ4MS00OC4zNjctMTMuNzg3LTY4LjgxNiw1LjA2MmMtMTcuODgsMTYuNDgyLTIzLjQ2LDQ0LjUzOS0xNi45NTYsNjcuNzU1DQoJCQljOC41NTcsMzAuNTE5LDM4LjQ1Niw1MS41NzcsNjkuOTA5LDQ4LjM2M2MzNi4yMjEtMy42OTcsNzAuODc4LTM3LjAyMyw2MC42OTItNzQuODQNCgkJCUMxMjcuODk5LDMzMC42MzMsMTA5LjQ5NiwzMTUuODQ2LDg5LjEzOCwzMDYuODE3eiBNNjkuMzE5LDQwMy42OTljLTE5Ljg1NCwyLjAyNi0zNi4wMDgtMTIuOTE4LTQyLjEzMi0zMC42MzUNCgkJCWMtNC41ODUtMTMuMjY0LTEuNzAxLTI2LjU5OSw2LjA5OS0zNy45MzNjMTguODA0LTI3LjMzLDU4Ljc0Ny0zLjk1Niw3Mi44NjQsMTYuNTMzDQoJCQlDMTIzLjU0NywzNzYuOTM0LDkzLjI4Miw0MDEuMjU3LDY5LjMxOSw0MDMuNjk5eiIvPg0KCQk8cGF0aCBkPSJNMTkwLjgwNSwyMjcuNzUzYy00OS4xMzQtNDAuMDUtMTE2LjEwMy00OS4xMy0xNzcuMzY5LTUxLjEwNWMtNC43OTQtMC4xNTctNy44OTYsMi4zMTgtOS4zOTUsNS42MjINCgkJCWMtMS4xNTIsMS42NDMtMS43NTcsMy44MDYtMS40MjIsNi41NGMyLjU5NSwyMS4xNDMsMi41NzUsNDIuMjg5LDEuMzUxLDYzLjUyNWMtMC40MTcsNy4xNzYsNS4xMTksMTAuNjA4LDEwLjY4OSwxMC4zODUNCgkJCWMwLjg3NCwwLjI0NCwxLjgwMywwLjQwNiwyLjgyOSwwLjQyN2M0MC45NzksMC44OTQsODQuNjM0LDYuODcsMTE3LjI5NiwzMy43OTljMzUuMTI0LDI4Ljk3LDM5LjI3Myw3Ni43MDgsMzUuNDQ0LDExOC45NDENCgkJCWMtMC4yOTQsMy4yNSwwLjcwMSw1LjcwMiwyLjM1Niw3LjQyOWMxLjcwNiwyLjYwMSw0LjQ5OSw0LjUzLDguNDYsNC43MzNjMjMuODY2LDEuMjI5LDQ3Ljc0OSwxLjM1MSw3MS42NCwxLjM1MQ0KCQkJYzcuMjUxLDAsMTAuNjk5LTUuODQsMTAuNDA5LTExLjQ1NmMwLjI3NC0xLjAzMSwwLjQ2My0yLjE0MywwLjQwNi0zLjQwN0MyNjAuMzc3LDM0Mi41MDUsMjQ5Ljg2NywyNzUuODg3LDE5MC44MDUsMjI3Ljc1M3oNCgkJCSBNMTkyLjUzMSw0MDYuOTAzYzIuNjMtNDQuNjQ2LTUuNzE4LTg4Ljk1NS0zOC42MDMtMTIxLjc0OWMtMzIuOS0zMi44MDQtODIuOTIzLTQxLjU2OC0xMjcuODg0LTQzLjM1NQ0KCQkJYzAuNTI4LTE0LjM3MSwwLjM4MS0yOC43MDYtMC44MjgtNDMuMDMxYzUxLjkyNywyLjU5NSwxMDMuNzg0LDExLjc4OSwxNDcuMzA3LDQyLjA2NmM1Ni4yMjksMzkuMTIsNjUuODcxLDEwMy43ODgsNjkuMDEsMTY2Ljg5Mw0KCQkJQzIyNS4xOTMsNDA3LjY3MSwyMDguODYyLDQwNy41MTMsMTkyLjUzMSw0MDYuOTAzeiIvPg0KCQk8cGF0aCBkPSJNMzEyLjA0Miw5MC45NkMyMjUuNDkzLDIwLjQyNCwxMDYuMjIxLDcuODg3LDExLjk3OSw0Ljg0Yy0wLjAxLDAtMC4wMjUsMC0wLjAzNiwwYy01LjAxNywwLTguMTgxLDEuOTYtOS45MjcsNS44MTINCgkJCWwtMC42MDksMS4wNjZjLTEuMTkzLDEuNzA2LTEuNjMsMy45NTMtMS4zLDYuNjgzYzQuMDMyLDMyLjg5LDQuNzc4LDY3Ljg1MiwyLjM1NiwxMTAuMDNjLTAuMTg4LDMuMjUsMC42MDksNS44MzQsMi4zNjEsNy42OQ0KCQkJYzEuOTUsMi4wNjQsNS4wODMsMy4yNSw4LjU5NywzLjI1bDEuNjA0LTAuMDUzbDAuOTY1LDAuMjY3YzEuMTkzLDAuMzIyLDIuMjM5LDAuNDgyLDMuMjgsMC41MDMNCgkJCWM2My41OTcsMS4zOTgsMTQ0LjM3Miw5LjQwNywyMDUuMDA4LDU5LjQwOWM1MS4zODksNDIuMzc5LDcyLjAyMSwxMTAuODg2LDYzLjA4MywyMDkuNDM0Yy0wLjI5NCwzLjI2MSwwLjQzOCw1Ljc1NCwyLjI0NSw3LjYyNw0KCQkJbDAuNzU3LDAuOTVjMi4xMjIsMy4yMjksNS4yODYsNC45NzcsOS4zOTgsNS4xODljNDEuMjQ5LDIuMTIzLDgzLjA5NywyLjMwMSwxMjIuNDMxLDIuMzA2YzMuNDIzLDAsNi4xNjUtMS4wNTcsOC4xMzUtMy4xMzkNCgkJCWMyLjIwNC0yLjMxNSwzLjQwNy01LjkzMSwzLjIxNC05LjY1OGwtMC4wNjEtMS4wMjVsMC4yNzQtMC45OTVjMC4zNzYtMS40MjIsMC41MjgtMi42MjEsMC40NzItMy44Nw0KCQkJQzQyOS41MzYsMjk4LjA5Myw0MTUuODQ1LDE3NS41NzEsMzEyLjA0Miw5MC45NnogTTQwOS45MTUsNDAwLjg3MWwtNi44NTUtMC4wM2MtMjYuNTEyLTAuMDkyLTU1LjA2MS0wLjMyLTg0LjIwMy0xLjQxNw0KCQkJbC02LjYzMi0wLjI0OWwwLjM5MS02LjYyMWM1LjE1NC04Ny40NjMtMTYuNDU3LTE1NS45ODUtNjQuMjUxLTIwMy42NTVjLTQ0Ljg3NS00NC43Ni0xMTUuMTQ0LTY4LjQ1MS0yMTQuODI0LTcyLjQxOWwtNi40NjktMC4yNTkNCgkJCWwwLjIzOS02LjQ3NWMwLjk3NS0yNi40MDUsMC41MTMtNTAuMjY3LTEuNDA3LTcyLjk0MmwtMC42MjktNy40MTJsNy40MzQsMC4zNzFjMTEyLjE2Miw1LjU5OSwxOTEuMDU5LDI4LjE4OCwyNTUuODE4LDczLjIzOQ0KCQkJYzk3LjAwNSw2Ny40ODksMTE1LjUxNCwxNzkuNzU2LDEyMS4wNDksMjkxLjAxOUw0MDkuOTE1LDQwMC44NzF6Ii8+DQoJPC9nPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPC9zdmc+DQo=" class="css-on3xa egf89ri5"/></a></div><div class="css-1yzdjlk e5kaaa13"><style data-emotion-css="1loed2t">.css-1loed2t{font-size:2.5rem;margin-bottom:0;text-shadow:1px 1px 1px #FFFFFF;}</style><h1 class="css-1loed2t e5kaaa11">Generate and host your own raster tiles customized with Mapbox Studio</h1><style data-emotion-css="jtg2ex">.css-jtg2ex{margin-top:10px;color:#606060;text-shadow:1px 1px 1px #FFFFFF;}</style><h3 class="css-jtg2ex e5kaaa12">26 July, 2015 - 9 min read</h3></div></header><style data-emotion-css="8lbmm2">.css-8lbmm2{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;max-width:860px;padding:1rem;}</style><div class="css-8lbmm2 egf89ri1"><style data-emotion-css="1rcp9ax">.css-1rcp9ax a{-webkit-text-decoration:none;text-decoration:none;position:relative;}.css-1rcp9ax a::after{content:"";position:absolute;z-index:-1;top:70%;left:-0.1px;right:-0.1px;bottom:0;-webkit-transition:top 0.1s ease-in-out;transition:top 0.1s ease-in-out;background-color:rgba(255,250,150,0.8);}.css-1rcp9ax a:hover::after{top:0;}</style><div class="css-1rcp9ax egf89ri4"><p>If you have never saw maps hosted in Mapbox platform you would probably agree on the quality of its designs. The business of <a href="https://www.mapbox.com/">Mapbox</a> is to host and server geospatial data. For this reason, all the great tools Mapbox facilitates are oriented to help their users to prepare and work with their data.</p>
<p>One of the provided tools is <a href="https://www.mapbox.com/mapbox-studio/">Mapbox Studio</a>. Mapbox Studio (MbS) is a desktop application that allows to create <a href="https://www.mapbox.com/guides/cartocss-in-studio/">CartoCSS</a> themes that are later used to generate raster tiles. Briefly explained, what MbS does is to download OpenStreetMap data in vector format and render it on the fly applying the specified CartoCSS style.</p>
<p>The result of working with MbS is not a set of tiles but a style, that is, a set of rules that express which colour must be used to render roads, at which levels must labels appears and with which size, which colour must be used for ground, etc. This style can be later uploaded to Mapbox platform so that raster tiles were generated on the cloud and we can consume the tiles paying for the service. (Hope one day I can contract their services, they deserve by their great job).</p>
<p>The question we can make us is: <em><strong>how we can generate the raster tiles locally from a given MbS style?</strong></em></p>
<p>Well, this article is about that. Continue reading.</p>
<h2>Working with Mapbox Studio and create your custom style</h2>
<p>Let's start from the beginning so <a href="https://www.mapbox.com/mapbox-studio/">download</a> Mapbox Studio application and install on your system. Once installed execute it and you will be asked to be connected to the Mapbox platform.<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACMElEQVQ4y52RS08TURSAZ4HxD6AWTFlJ3LjoUCnzqCVEQ0ElkyoJbsQYY9KGlQuCS+j7GQmi4itxobFsjAnBGXVmStspBZq2GzWuYMFGRV2YsBCZOd47M0UKvif5ck7O47snGeKpd3JPVpodFMqLQ/PVt16l8tqnVN74cCxUjTgjKb7ZTFHPFbNmzOi5F80N5cuvLjyYfrKXOHx8cH9vQljn7lWAu7UE3FRpF303FxE/7+Edz90q9KbEr0f6rxwkGinOQo7y7+yhDLQFxQ3Et52Qgd21bWzYQzKQo8/Wmk9ctBIW5ozF4ec/0PEcUBFJRWjbYaKy5opnNGcso9ERWdvZxzt0LAuOgPDJ6r6EhR4sXMPCjrCkInDEcnCEJDgaFOH0dQVOTuTBjvL2kNGrzeEdCgv9wmdr9y+EVETWZd3XcnDuzgL0TxVh4PYCnL+/BO7xnCmVt4T0n4XoOhQ7E3PQN6nAqQl8oQLcjYJec4Trrvw7IY7OmAyuuIwuzUIPugznuKaL/kVYG2aiGehMZvWrXCa49lvhAdpjaffz76noHGqKm6ZUhw2/ULsigtoVfa6yQV6lx2ZUKsCbfbEWNyn0CDrqo3Ehe7apI/Tyi3O8BEyyAEyquAWbKoAzqcCxlAJMIg/4bzIJpW6GSc4Di3aRY72l53IL0djm3mcbflgiR9Kr5MjjZcTKD9IrNhOck1enjVg3g3fSq7bhR+Um10Azgb4GhBXRijj0n7SajobvHTYzwwGFeyUAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015 07 25 at 23 43 15 1024x680"
        title="Screen Shot 2015 07 25 at 23 43 15 1024x680"
        src="/static/928f9885bb7091dfc023cd9b14b45a27/dbb61/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png"
        srcset="/static/928f9885bb7091dfc023cd9b14b45a27/19bd1/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 163w,
/static/928f9885bb7091dfc023cd9b14b45a27/d3bcb/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 325w,
/static/928f9885bb7091dfc023cd9b14b45a27/dbb61/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 650w,
/static/928f9885bb7091dfc023cd9b14b45a27/6b691/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 975w,
/static/928f9885bb7091dfc023cd9b14b45a27/3b243/Screen-Shot-2015-07-25-at-23.43.15-1024x680.png 1024w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>There are two main reasons why Mapbox requires you to register as a user. First, the power of the platform is on the cloud and the goal is you upload all your data to the servers. That includes the styles you create.</p>
<p>Second, MbS retrieves data in vector format from Mapbox servers. When you register as a user you get an API token that identifies your requests. Each time MbS makes a request to extract data it has your token that identifies you as user. This way Mapbox can control if any user is making a bad usage of their platform.<br>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACm0lEQVQ4y52Q60tTcRjHzwujF4WX6XRrHt3lnM2d4za3lWlKkZvkxirMEaLVyLBcRhkVhlBohYRQidmFbr7oJpkTka5CtHOkN1L9BSnRm8qMiJTytPP0/I5rGSpEP/jwnPM83+/3d6EiofYlzwZv7ngoPGocEV80REUxLCBRQQiLiCBEw4MDkfAQIuI36ZGZ8Fsnig2CONL4PCqEbvT0LKVonT6zsHTdVIm3Ako8c/D6odjjhyJSq7ZBcWUtrPb4oAh7JeX+hG6NZwOUen1QuLbsh5616KhlqSqNjuHeZ7M8ZLPcTLaZl3RGVrLWHJPWt/VL3uN3JM+JPuS+5GvrlbwnI5J1eytqzBLRKh6WAx1jnUhOV9NUiipDY+DsH035TjDyBTFjvlM2WDjZvf+SHLj8Sg50ibLnTFQuQ8rPIt2jsqvpqmzI42WiJR7iNXCOSVWmlqaSMVBvtU/gAJsYyOPQwoFzbye4WvrA0XQdHAd7wI7YDlyDgqP3wLWvGzU8KB5yCKyY8TltfqAjEZi/pxNWtT4AV3Mv2I70Anf4LnCHbgPfMgh8+Lyi+efAXDMHFc0XYcu5JxA41Qeb2vsh2DEAwdP9UN31FPwtVxSNsrniWTBw9g3Je+hMeTD0eBhuvZ6EjuE3cEF4C1++TcPM92kgSxRF0BotkHj3RQPju+Xm2cBXuRWqQrthY00dbK7dBTU766G2rh5C9WEIBKsVzZ9bzQ/8EB/+jAtieIJYVq4pptEzsSxEnWNCmFgGjT2DWdEQLfHEAz/FA9VabH5l7G7lCiabC6sLWPxnHSsTmOfA/qV1AmNzk8NMqbK0OdTy1DQ1zVpHc8zcO5rlxpDxhcD5+CKzsVmv9WVKeuYKClcSQiMswvwnbDwj6Rfcsph85R2QtwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015-07-25 at 23.43.26"
        title="Screen Shot 2015-07-25 at 23.43.26"
        src="/static/c4bef936ec3084ba5ef4c05341dc0817/dbb61/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png"
        srcset="/static/c4bef936ec3084ba5ef4c05341dc0817/19bd1/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 163w,
/static/c4bef936ec3084ba5ef4c05341dc0817/d3bcb/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 325w,
/static/c4bef936ec3084ba5ef4c05341dc0817/dbb61/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 650w,
/static/c4bef936ec3084ba5ef4c05341dc0817/6b691/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 975w,
/static/c4bef936ec3084ba5ef4c05341dc0817/3b243/Screen-Shot-2015-07-25-at-23.43.26-1024x680.png 1024w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>Once logged in you will be allowed to create new map styles. The easiest way is to start using one of the starter styles created by the great Mapbox designers:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADdUlEQVQ4y5WSXUybVRjHXwnIFifYZa0vmhISviwGtND2bSlQwHYt7cZHqVtphJYOcQ0JqF0C65dVRoGRTZbRWWtLtwnqROVCw4U6hN4aQwL3ey92o1Z3YbIL15337+nrtsRLL/55nnOS8z+/54PZdM+V/PD16sh3P307kd3Jnr19+0ff9va2b2dnx5fNZn27u7u+zc1N39bWlu/g4IBq37e/v/8oF3V2b29vgr5xLy8vlzLSw4dkKqvzfscJB05ae/Ca0Yju7m6YzWZYbTZYrVYY6Z3dbkckEkEwGBQVCASexFgsBq/X+3dVVdWLzNMlRays+uVfG15pgcVkfKDVavMqlSpfiFqOy+u0nJjr9fp8W1ubGAvq7OzMt7e353U63YORkRHMzMzkNBqNnCkrL2crZNLfm5VKeMbeIk7XG8Lw8LDQ2z8g9A4OCrZ+u9Bvtwsmo1GgpEJXV5fQ0dEh9PX1CRaLRTAYDGR0dBShUOhPai5nJEePslKZLKfV6ZD6coskNr7Hzc++wZvvnMOQP4B3Y0uYjkahUChQX18vipKgrq4O1dXVqKysJBQA4XD4nkgokUhYqVSa4zgNVlMpkrl+AysrKzjn9+Na/Bpu0HM4HCkQIJ1OIx6Pw+12o6mpSTRubGwkhXPBkOM4OXPkyLNsRQWbU2l09HGKbKwnkUx8hGA4hCQ1W1tfxeLiLObn57G+tobrmQzOeL2g/RSHRct/XPK9f0sWCY/lVGoNrsQvkkTyMpYuzcN/3o8P0wkkPk3ivbkIps8HsLB0EdHZ93Ha6USbXg/aT9ABPTGkw5Mzsudl7HMSSU6jVuHC1UUSvRJDaCEC3/QEglc/QPSTBGbmZuF0ezE2+TZc4+M4bjtRIBMNKel/DY/JWFZSXvbbS00tWEhmHn5x6yZJpz4mg45+YjKbiMNhJxbbSTJ9YZF8dWuVbHyeIWNnPKS1tZVQQ0IJH3o8nsJO/iEaPnPocEVNbc1fOk6LOcspXHIMYWFyki7ygNgjS08PTMfN6B0YwJDrdbhcp+iy91C67sc9xDilpkt/n35SyRQ/VSRVNDT83KJ89e5wnfKOW9HMn2438AZtK6/hOJ5OjqcLzqvVKr65uUUUnS5PaXg6BHqvvuNwOO5OTU39olQqX2BKSkuLGYaRU9Uy5UU1TFlxDc3/r2ofeRT/AwfV0+tthqF/AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015-07-25 at 23.47.38"
        title="Screen Shot 2015-07-25 at 23.47.38"
        src="/static/8555c62ce7a37effc9ba46d7e4f1ac2c/dbb61/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png"
        srcset="/static/8555c62ce7a37effc9ba46d7e4f1ac2c/19bd1/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 163w,
/static/8555c62ce7a37effc9ba46d7e4f1ac2c/d3bcb/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 325w,
/static/8555c62ce7a37effc9ba46d7e4f1ac2c/dbb61/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 650w,
/static/8555c62ce7a37effc9ba46d7e4f1ac2c/6b691/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 975w,
/static/8555c62ce7a37effc9ba46d7e4f1ac2c/3b243/Screen-Shot-2015-07-25-at-23.47.38-1024x680.png 1024w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>Here we have chose the <em>Mapbox Outdoors</em> style. In the image you can see the style code (CartoCSS which is inspered by CSS) and the resultant tiles obtaining from painting the vector information with the given style rules:</p>
<blockquote>
<p><a href="http://wiki.openstreetmap.org/wiki/CartoCSS">CartoCSS</a> is a <a href="http://wiki.openstreetmap.org/wiki/Mapnik" title="Mapnik">Mapnik</a> <a href="http://wiki.openstreetmap.org/wiki/Stylesheet" title="Stylesheet">stylesheet</a> pre-processor developed by <a href="http://wiki.openstreetmap.org/wiki/MapBox" title="MapBox">MapBox</a> and inspired by <a href="http://wiki.openstreetmap.org/wiki/Cascadenik" title="Cascadenik">Cascadenik</a>. It is like a CSS language specially developed to style maps.</p>
</blockquote>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADUklEQVQ4y52Ty28bVRTGZ1HEgrJAVStDcUwU6pCoz+B/gSV7ViB2tbKLIkFLWyuJ01aFVlWDVFLxkNiQsEE0FSoQO3GcpPakTuJ3Zsb2zDh+T2bsOH7EHt/5uHZKJLYc6dPR3fz0feecyzz9/M5rrt9++nTBtTDqdq1cXVx0291uj3152Wv/+y+X3UXfc3O/2hcW/rAnEgk7zwv2nR3OznHHusrz/KjH4/lsamrqdWbgrTfOfHztu/rY/Sf4/vEDzD75FrOzM/jxh8d4NHMf3zy4B6fzFuZ++RndardbaDYaaDabxyKEYH5+vmWz2c4y7717ynTho08Kt2ceoqyF2oXilp7LBvQ8VVJm9Z3ECz3G+fUdidNrlZquaRVdq1T1dqulHx4edtWmhUqlojgcDjNjHbSaLgwNlhy3voAkhUmc9xlJ+aUhpTcNUWaNVHrbYAXBCMqyoaZVIycphpAuGOX9A6Nerxu1Wo1QKMrlsup0Os3MwEC/6fz5i8pXN79EIOgj3rVlLHn/xPLKIthND4JxFj5eQFiWUM5qyGcU8LtFNF7Fpp3out4FapOTk2ZmcHDANDQ0rEw5ryOnBEmU82ErvIpAyIuN7SWEOS9YgUNIkqCm95ChQDmvollv9KDUHenOkEY+AlosZ02XLl1W7n3tQL0uEEncQDa7BTnNIhxbQpDbBJtIICSK0PIa1KyKfGGPqoT9agUHBzXSarWgqqrWm+HwsNVktX6g3L17A+UqR3jBB4663A6/gD8UgJ/nj4CSCDWjokBdypJCARro/LqxSafT6TmcmJgwMx/aLpssln5l0nkNRTVCItw62HicQpLYSCbxksJY4QhYEksoSSr4VBGqUvn3bI6BvchdYF+fpXj95jiyhVBnkwsRfyJJqDNCt0somPhoD6aSZF+tkGq5SsrVA1JvNkgXRufY6UamS9nrOezv73v7ypWR6u07N5BVJQQzOUTzOURyR53Py4jmMpCUHEhbR/fmemXgP0Xj16enp/uY02dOnR4ZsW2Mj4/uuvzrqd89K+IzL9XqqvjUvSiurz8Tn68tic9X18RoJCJGo1ExFouJ8UhcpF9OFAQhRb/kbjweD4yNjb3DnDz55gmGYcxU56je/58694px4h8FNvF7WSGOxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015-07-25 at 23.54.20"
        title="Screen Shot 2015-07-25 at 23.54.20"
        src="/static/7d14da8bc929b84b9233767d305f1f9c/dbb61/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png"
        srcset="/static/7d14da8bc929b84b9233767d305f1f9c/19bd1/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 163w,
/static/7d14da8bc929b84b9233767d305f1f9c/d3bcb/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 325w,
/static/7d14da8bc929b84b9233767d305f1f9c/dbb61/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 650w,
/static/7d14da8bc929b84b9233767d305f1f9c/6b691/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 975w,
/static/7d14da8bc929b84b9233767d305f1f9c/3b243/Screen-Shot-2015-07-25-at-23.54.20-1024x680.png 1024w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>Store the style with a new name somewhere on your computer, for example, <code class="language-text">customstyle</code>. If you look at your disk you will see a <code class="language-text">customstyle.tm2</code> folder has been created containing a bunch of files that defines the style rules (take a look they are not dangerous).</p>
<p>Finally, modify some properties, for example <code class="language-text">@land</code> or <code class="language-text">@crop</code> colors and save to see the result:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.40625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADb0lEQVQ4y52T3U+bVRzHn4sZL+aF0bjULR0F6YXbYOvQv0Ljn6DxwmTNksnY3OLILBQqRVmoi/FOBrqpyMQ8faOjpaWl0PUFJqNvtB3PsEXo+wt9oTw9z9fT7iXx1l/yzTnn4nzy/f7O+THsp+pXbOzUx3qb4aLD5rxgX3TIl+xO+bJzRb5gsckXzFb59K8zcp1+Th6LxeSRSFQeDoflm5ubL3QhEolcDIVCn8zOzr7KSNvaj3304QeVvqu9+P4HDcY0oxi/PfZsP67Gre9GoVTdxC/37qBZh4d11GpVqlpL1WoVhBAkEon6yMjICUYsOSHq7pbtKZTXsfFk6dD5l5FfcLO80X6fX1zX8fYQy88/1PEmj4+vFit8JpPnk9kCX6/X+YODg6YOaaFYLKYHBgbETKe0Q9TddTbVr7iOR6EV8tBvFtybFsEVoGvYJLj8VmFMtyxMLAWEYiInxLeSQpDbFXKFklCpVIRyuUwoFPl8Pjs0NCRmJO+0ibrOdKWv9PfCsvqA6K1asIt/QGubpWctTB4Thlk3fnb6UdrNYyeRQjSebEV9HpnwPI9CoZBTKpVipqNTIjp96kz62s1euGPzxBO0wvH4AUw+Fgbffcyv/Q7N3DLuOPwo7mQRj6ewvZtFrVJtQak70uzhS6Do+DHReVkPBV6GO2ghFhcLx5oRgSeLcAb+BOuew6jegynHBoqpPDIUurvXVArFUgH7+2VC+4lsNptTKBTUobRddOrd0+krX16CK2glSz4T7B4DLC4z7s5boDF6MKz14qclCvwnh72/M9h+mqaAHGj/mrFJo9FoORwcHBQzsvPdIomkI92vuIrgzgpxrs9hwrwCtd6HUcMabhl9+FrnxRQFZrfTSD7NIrKVRDZdePF1XgJbkWXvnRW1nZQkr311GbE9V+Oe1UxUWi/5xkCl9xK1fpUMsR4yaV8n5XyRFPMlki/tk0qtSpow2sdGMzJ95UzLYVu7+G3ZuZ7SsPoGPLE1aCwBaKxBaBaerRPODdy2Pob2URSgTpqXWyXgP0XjV1Qq1UnmjTdff6un533vpc8/i4/PsFtf/Gjg+if13I1JA6eY1HLTurvc2G8z3LfTZi4c9HN+f4ALBoNcyB/i6Mhx0Wh0i45knI7eal9f33Hm6NHXjjAMI6aSUnX+T0mfM478C8gp2Jh7gedDAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015-07-25 at 23.54.47"
        title="Screen Shot 2015-07-25 at 23.54.47"
        src="/static/50ca2991cafbf2042a25c345746d1800/dbb61/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png"
        srcset="/static/50ca2991cafbf2042a25c345746d1800/19bd1/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 163w,
/static/50ca2991cafbf2042a25c345746d1800/d3bcb/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 325w,
/static/50ca2991cafbf2042a25c345746d1800/dbb61/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 650w,
/static/50ca2991cafbf2042a25c345746d1800/6b691/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 975w,
/static/50ca2991cafbf2042a25c345746d1800/3b243/Screen-Shot-2015-07-25-at-23.54.47-1024x680.png 1024w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>Great !!! You just have created your first custom style.</p>
<h2>Generating raster tiles from MbS style</h2>
<p>Looking for a solution I discovered the <a href="https://github.com/mojodna/tessera">tessera</a> and <a href="https://github.com/mojodna/tl">tl</a> tools. <em>Tessera</em> is a node based command line application. It is based in some modules from mapbox (concretely tilelive) plus others implemented by the author (<a href="https://github.com/mojodna">Seth Fitzsimmons</a>). The result is we can execute tessera passing a MbS defined style, open a browser pointing to a local address and see a map with the raster tiles generated with our MbS style.</p>
<p>Similarly, <em>tl</em> is a node based command line tool we can execute, passing a set of options, to generate a <a href="https://www.mapbox.com/guides/an-open-platform/#mbtiles">MBTiles</a> file or a pyramid of tiles following the well known <code class="language-text">z/x/y.png</code> format.</p>
<blockquote>
<p>I know about both tools at the article <a href="http://www.azavea.com/blogs/labs/2015/05/converting-mapbox-studio-vector-tiles-to-rasters/">Converting Mapbox Studio Vector Tiles to Rasters</a> from <a href="http://www.azavea.com/">Azavea</a> Labs.</p>
</blockquote>
<h3>How to install the tools?</h3>
<p><em><strong>NOTE</strong>: You need to have <a href="https://nodejs.org/">NodeJS</a> installed in your system, along with the npm package manager command line tools.</em></p>
<p>I don't like to install global node packages (or at least more than the necessary) so I'm going to install the previous tools in a custom folder:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>mkdir tiletools
cd tiletools
{% endhighlight %}</p>
</blockquote>
<p>Inside the directory execute next sentence, which install the <code class="language-text">tessera</code> and <code class="language-text">tl</code> packages among others:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>npm install tessera tl mbtiles mapnik tilelive tilelive-file tilelive-http tilelive-mapbox tilelive-mapnik tilelive-s3 tilelive-tmsource tilelive-tmstyle tilelive-utfgrid tilelive-vector tilejson
{% endhighlight %}</p>
</blockquote>
<p>You will see a hidden directory named <code class="language-text">.npm_modules</code> has been created which contains some subdirectories with the same name as the previous packages.</p>
<h3>Running tessera</h3>
<p>Let's try to run tessera for the first time. Because it is installed as a local node module execute:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>./node_modules/tessera/bin/tessera.js</p>
</blockquote>
<p>Usage: node tessera.js [uri] [options]</p>
<p>uri     tilelive URI to serve</p>
<p>Options:
-C SIZE, --cache-size SIZE          Set the cache size (in MB)  [10]
-c CONFIG, --config CONFIG          Provide a configuration file
-p PORT, --port PORT                Set the HTTP Port  [8080]
-r MODULE, --require MODULE         Require a specific tilelive module
-S SIZE, --source-cache-size SIZE   Set the source cache size (in # of sources)  [10]
-v, --version                       Show version info</p>
<p>A tilelive URI or configuration file is required.
{% endhighlight %}</p>
<p>Tessera requires you pass an URI so it can server its content. It accepts URIs from Mapbox hosted file, Mapnik, Tilemill, Mapbox Studio, ...</p>
<p>Repeat again indicating the path to our previously created style indicating the protocol <code class="language-text">tmstyle://</code>.</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at <a href="http://0.0.0.0:8080/">http://0.0.0.0:8080/</a></p>
</blockquote>
<p>/Users/antonio/Downloads/tiletools/node<em>modules/tessera/server.js:43
throw err;
^
Error: A Mapbox access accessToken is required. `export MAPBOX</em>ACCESS_TOKEN=...` to set.
...
{% endhighlight %}</p>
<p>First seems tessera is working at port 8080 but later we get an error about <code class="language-text">MAPBOX_ACCESS_TOKEN</code>. If you remember from the first section, Mapbox requires all the requests be signed with the user token. So, you need to get the access token from your account and set it as environment variable before execute tessera:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>export MAPBOX<em>ACCESS</em>TOKEN=your<em>token</em>here
./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at <a href="http://0.0.0.0:8080/">http://0.0.0.0:8080/</a></p>
</blockquote>
<p>/Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
throw err;
^
Error: Failed to find font face 'Open Sans Bold' in FontSet 'fontset-0' in FontSet
{% endhighlight %}</p>
<p>We are close to make it work. The problem now is our MbS style is using a font we have not installed in our system. One easy, but brute force, solution is to install all Google Web Fonts on your system. For this purpose you can use the <a href="http://webfontload.com/">Web Font Load</a> installation script. In my case I have installed them in the user's fonts folder <code class="language-text">~/Library/Fonts</code>.</p>
<p>Once fonts were installed try executing tessera again:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at <a href="http://0.0.0.0:8080/">http://0.0.0.0:8080/</a></p>
</blockquote>
<p>/Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
throw err;
^
Error: Failed to find font face 'Open Sans Bold' in FontSet 'fontset-0' in FontSet
{% endhighlight %}</p>
<p>That' s a bit strange, we have just installed the fonts but they are not found. What is happening? Well, tessera uses mapnik to create the raster tiles and it looks for fonts in the folders specified by the environment variable <code class="language-text">MAPNIK_FONT_PATH</code>, so let define the variable:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>export MAPNIK<em>FONT</em>PATH=~/Library/Fonts/
{% endhighlight %}</p>
</blockquote>
<p>and execute the script again:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at <a href="http://0.0.0.0:8080/">http://0.0.0.0:8080/</a></p>
</blockquote>
<p>/Users/antonio/Downloads/tiletools/node_modules/tessera/server.js:43
throw err;
^
Error: Failed to find font face 'Arial Unicode MS Regular' in FontSet 'fontset-0' in FontSet
{% endhighlight %}</p>
<p>OMG !!! This seems a never ending story. Now we need to install the Arial Unicode font. <a href="https://code.google.com/p/tuanphamvu/downloads/detail?name=Arial%20Unicode%20MS.rar&#x26;can=2&#x26;q=">Look for it</a>, install in your system and execute tessera again:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>./node_modules/tessera/bin/tessera.js tmstyle://./customstyle.tm2
Listening at <a href="http://0.0.0.0:8080/">http://0.0.0.0:8080/</a>
{% endhighlight %}</p>
</blockquote>
<p>Great !!! It seems tessera is working fine. Let's go to open our browser pointing to <code class="language-text">http://localhost:8080</code> and see the result:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 91.81916038751345%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAADyUlEQVQ4y6WUW2/TZhzGOy42pnIzdrMLPsG+xaR9BXLB5T4AGtI+wCTQytqNlgwQqzZttB095FjHZzuxc7Kd2G/SOAfn0KTtCCpiXBAuwfazNyllVGPiYpYe/WXr9e99/s97mJub+2pu1Kp/0dtvXvF6+5e7XjfS7/cjo9EoMhgMIv1BP9Ltdql6kW6vG+n1ejNNvw36g8j4z6PL4/H4iud5X87Nngufn29UCnuH4z4GwwOMRkPQgXhyfIzH48d4+uQpXkxeYDKZYPL8RM+nlb7/9ewZPDr28OAAhDgdSvtghjRrFYe0CaxG6ZXRLgaaJwU5TwyMrhbYg2JADktBfWQGztAIakflwDrSg+G4HuTtenBXcl79nndxjy25lPXRFDhv2hYpVC0wIufzMh9mTCaMlxNhppgOk2o8FG0hFBrpMF3bCVPNzbDgSWHVlcNf5EJ4g3H8W9k2vo0VmpT14QyYKSdI3lMRz8f9dG4XbJ6DUBShmjJi2ja22AQkXYFAOEiNDAodGWo1iYeqjjtM0V9Va7ieKP4D3HU2Sf4RB76T8BWXg9YQUarlINsCmL1tMGYSiiEiW5GRMVhsWOtIkk0otogVwfJXqMMb8bccMvoOMQYqcm3G1/s8KvsqnG4BmitAcHepUkjXNsG4O2AbcayTVSjtFJ1AQVQyacuds8CU/AcpuQpKdcl3OhoqIxVFGkHJk6D1eOQ9EWZfpRNJUJq7iLc2UGiz0PdERMXKCTDxGvjJ+fl50YgRs6Uga7N+tsoiR7PKN6RZtVwVzWER9b6Oal+G0Ioh426h2mWpax4/8ra//DZw6pArb5N6X4NGWF+00uD0BLg8VZEuhpEGaWswXQliKwm5kYBcS2Hb0PEDb+MmS/zbuTaun2k5u0UKLg2dMH6+JkEy03QVd1HYE2BQ52SYg+3JMBwG6ZyMqGBhIUOwyDlY4hwK7JwFxhSaYTsLtSb5ZerGauRg9VRoHQZGnadtZ2n7WWzqGpYzFm5yBEu8M9Piu4BcMUaMlgq7pfnVpgabQusDHZypYl3J4Z5UoVkRLLAE37+BnTh8J7Dc4EljVEJ1qPhyM41yU4BKirMfFtjaNCcKct64OoW9rv8GVlzF7j2yoQ0yL9POjp+vsP5vsuIvsI6/xNn+NKfF/5T9cllpToGNU+AFuZlsH05cdI8rdIuUwNs2orqH25qH6Hs0PSX3rSN8lzIGp8CP7ydu/brG/FxPZB6YG4lV65s7a9bV6KZ17aeH1tfvl3Ht7lb96srag9Pb5hzVRapL/1MXP/3s0rm/AWZHxY8dZvjwAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015 07 26 at 16 01 43"
        title="Screen Shot 2015 07 26 at 16 01 43"
        src="/static/93475e0853caa70a4aeb267f060319c9/dbb61/Screen-Shot-2015-07-26-at-16.01.43.png"
        srcset="/static/93475e0853caa70a4aeb267f060319c9/19bd1/Screen-Shot-2015-07-26-at-16.01.43.png 163w,
/static/93475e0853caa70a4aeb267f060319c9/d3bcb/Screen-Shot-2015-07-26-at-16.01.43.png 325w,
/static/93475e0853caa70a4aeb267f060319c9/dbb61/Screen-Shot-2015-07-26-at-16.01.43.png 650w,
/static/93475e0853caa70a4aeb267f060319c9/356ef/Screen-Shot-2015-07-26-at-16.01.43.png 929w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>A map implemented using Leaflet web mapping library is shown, rendering raster tiles that are created in the fly. Look at the console to see the tessera output information:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 83.67983367983368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAACHElEQVQ4y62UTY/SQBjHC7QLhBd567qUzpQKhf0O6s3voE28euAzeLAm3gDlJUFT1s1+iQ0nLx69u7uFIbjSxaxvMYEKlMP6DLBEswmY7jb5JTOd6a/zfzpTZo+5YL4b7x/0f3Yej63pI2tkqaPRaI71e6wOfvxSTdNUz8+/qoMvA3U4HKqTyUQdj8craN+yrIe9Xi/KeF23/PVXxQ/7B28v9L3m9E3z9aypN2e6rs8ajYb9slKZFotFu1wu25VKxa5Wq3atVvubab1et0ul0qRQKNxj4ArF4olDURBPE8m4sRXh2rFIzIjGoobH4zmG8Y//yRFwlwqDGOPWbn73TM6lCZ9OdGVJJnCPhMPhNoyfuFwuAzhZg+F2uw2O4xZChFArr+TPcAYRXqLCO91UKrUSAsYaVuMsyy6EIhJbSlYxcRaTBI53sYhJUkgSv9/vUCiCMKOYCFZ4KRQEgfh8PmdCGpkKaeTtNN+VkETgJSQYDDoUYjSPjJY1pCukwkAg4DxyNpP9p4Y08vVquPwocRQD4SKyY+G8htlFDW9khVSYU3KryCh1Zdts4so+PISN3ZcUqb0t8ySN0x04KZ1QKEQnHm/g6LI9F8JDIYj3Dono2454+3M0GTGFHaHP83zf6/WewsQe8GkNq3EQ3mcgrg/22xPovGA59pmH9WhwJjVoa/Bz0OCcanBON/EceArzZWZ5uQHuGmwBLOD6A5IOX5M8xJf9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015 07 26 at 16 03 20"
        title="Screen Shot 2015 07 26 at 16 03 20"
        src="/static/7fd6122a6dd6f365ef57506522a7f15a/dbb61/Screen-Shot-2015-07-26-at-16.03.20.png"
        srcset="/static/7fd6122a6dd6f365ef57506522a7f15a/19bd1/Screen-Shot-2015-07-26-at-16.03.20.png 163w,
/static/7fd6122a6dd6f365ef57506522a7f15a/d3bcb/Screen-Shot-2015-07-26-at-16.03.20.png 325w,
/static/7fd6122a6dd6f365ef57506522a7f15a/dbb61/Screen-Shot-2015-07-26-at-16.03.20.png 650w,
/static/7fd6122a6dd6f365ef57506522a7f15a/d418b/Screen-Shot-2015-07-26-at-16.03.20.png 962w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>We can see how tiles at current zoom, the zoom level 8, has been generated.</p>
<p>At this point we have tessera working but what about generate a local pyramid of tiles for a given zoom levels and a given bounding box?</p>
<h3>Generating a custom pyramid of tiles with tl command line tool</h3>
<p>Before continue we need to know which bounding box we want to generate, the whole World? or only a piece. In my case I want three zoom levels (7, 8 and 9) wrapping Catalonia.</p>
<p>There are some online tools you can use to get the bbox of a region, but one I like it the <a href="http://boundingbox.klokantech.com/">Bounding Box Tool</a> from <a href="http://www.klokantech.com/">Klokan Technologies</a>.</p>
<p>The tl tool can run three main commands but are only interested in the copy one, which copies data between two providers. In our case the MbS style is one provider and the file system is the other. Run the tl command to see the available options:</p>
<p>{% highlight bash %}</p>
<blockquote>
<p>./node_modules/tl/bin/tl.js copy --help</p>
</blockquote>
<p>Usage: node tl.js copy <source> <sink> [options]</p>
<p>source     source URI
sink       sink URI</p>
<p>Options:
-v, --version                 Show version info
-b BBOX, --bounds BBOX        WGS84 bounding box  [-180,-85.0511,180,85.0511]
-z ZOOM, --min-zoom ZOOM      Min zoom (inclusive)  [0]
-Z ZOOM, --max-zoom ZOOM      Max zoom (inclusive)  [22]
-r MODULE, --require MODULE   Require a specific tilelive module
-s SCHEME, --scheme SCHEME    Copy scheme  [scanline]
-i FILE, --info FILE          TileJSON</p>
<p>copy data between tilelive providers
{% endhighlight %}</p>
<p>So let's go to execute the command to copy data from our MbS style to the local <code class="language-text">tiles</code> folder. We want to generate tiles from zoom level 7 to 9 and indicating a bounding box wrapping Catalonia.</p>
<blockquote>
<p>Remember the <code class="language-text">-b</code> options must be indicated as <code class="language-text">[minLon minLat maxLon maxLat]</code>.</p>
</blockquote>
<p>{% highlight bash %}</p>
<blockquote>
<p>./node_modules/tl/bin/tl.js copy -z 7 -Z 9 -b "0.023293972 40.4104003077 3.6146087646 42.9542303723" tmstyle://./customstyle.tm2/ file://./tiles
Segmentation fault: 11
{% endhighlight %}</p>
</blockquote>
<p>Ough !!! That hurts, a segmentation fault. After looking for a while I realised it <a href="https://github.com/mojodna/tessera/issues/9">seems a bug</a>. To solve it go to <code class="language-text">tl/node_modules/abaculus/node_modules</code> and remove the <code class="language-text">mapnik</code> folder dependency. It is redundant because there is one installed in parent folder.</p>
<p>Execute the command again and see the output:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 83.67983367983368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAABmUlEQVQ4y62UvU7CUBSA29I2NrRAKz+VzYSfh1A330Fv4urAMziIiRNpk5YyaowPYXRycXQWKJgUqJGAicYg6Y8DnosUBxcaOnzp7bn3fjn3np4SF8SM+Og87Nvv3SPP/T50XAc5joNc4Mvx0PPbJ3qxbTQajdHrcIgmkwlyXXe+JgC/T6fTA8uyRIIgGK6hKY9X15czw2i4uq579Xrdx+iAqul+rVbzVVX1NU3zYd4P5hd4hmH4iqK4lUplF4SEIMtbN5K02YPxE9BcPMOC9+1gIV8qle7y+bzN83w7Ho93INYmSdIE2itiUhRlMgzzJ0yn04NEImGKotjFQsBckeVamqZ/hcViMXphJpMZpFIpE8TRCHO5nI2FkWSI71CWZTuZTJogXV9YKBSWGUqSFI0wyDCSI5fL5XmGuMpAJ7IqYyFkGWQYhn9Fuc1ms31BEFpYCrFWCJrBOBAKcIf3cOQxtJ7FcVwfYhbQW5HlWhDuYeEGVPYYevicZdlToAq9WYXeDMMZcBKLxbYJ+FSwlML/sTVgARogfwBXtk/aD7TBpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Screen Shot 2015 07 26 at 16 27 56"
        title="Screen Shot 2015 07 26 at 16 27 56"
        src="/static/f1704bc2ed5ee13e403f31a4b4096ce1/dbb61/Screen-Shot-2015-07-26-at-16.27.56.png"
        srcset="/static/f1704bc2ed5ee13e403f31a4b4096ce1/19bd1/Screen-Shot-2015-07-26-at-16.27.56.png 163w,
/static/f1704bc2ed5ee13e403f31a4b4096ce1/d3bcb/Screen-Shot-2015-07-26-at-16.27.56.png 325w,
/static/f1704bc2ed5ee13e403f31a4b4096ce1/dbb61/Screen-Shot-2015-07-26-at-16.27.56.png 650w,
/static/f1704bc2ed5ee13e403f31a4b4096ce1/d418b/Screen-Shot-2015-07-26-at-16.27.56.png 962w"
        sizes="(max-width: 650px) 100vw, 650px"
        loading="lazy"
      />
    </span></p>
<p>The tl tool has created a local tiles directory and generated all the raster tiles for the given zoom levels and bounding box. The output shows in addition the time required to generate each tile.</p>
<p>That's all. Now we only need to host the tiles at our own servers !!!</p></div><style data-emotion-css="vl390q">.css-vl390q{border-top:1px solid #CCCCCC;margin-top:40px;font-size:0.7em;text-align:center;}</style><footer class="css-vl390q egf89ri6">© I built this site with<style data-emotion-css="1d5m7t5">.css-1d5m7t5{margin-left:5px;margin-right:5px;}</style><a href="https://www.gatsbyjs.org" target="_blank" class="css-1d5m7t5 e46mkkt0">Gatsby</a>from the starter<a href="https://github.com/niklasmtj/gatsby-starter-julia" target="_blank" class="css-1d5m7t5 e46mkkt0">julia</a>and made a bunch of modifications. The full content is available in my<a href="https://github.com/acanimal/acanimal.github.io" target="_blank" class="css-1d5m7t5 e46mkkt0">repository</a>. Icons made by<a href="https://www.flaticon.com/authors/freepik" target="_blank" class="css-1d5m7t5 e46mkkt0">Freepik</a> <!-- -->from<!-- --> <a href="https://www.flaticon.com" target="_blank" class="css-1d5m7t5 e46mkkt0">Flaticon</a></footer></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-8297669-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2015/07/26/generate-and-host-your-own-raster-tiles-customized-with-mapbox-studio";window.webpackCompilationHash="642efac6ed852a3b544d";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-23466d4bc1e9c7aa54ed.js"],"component---src-templates-blog-list-js":["/component---src-templates-blog-list-js-d0c4b51a6fc6f897180a.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-617c46b3566c32bb10ba.js"],"component---src-templates-page-js":["/component---src-templates-page-js-d373f64b90a49c4546f5.js"],"component---src-templates-digest-post-js":["/component---src-templates-digest-post-js-ccebe6b859961fa7301d.js"],"component---src-pages-404-js":["/component---src-pages-404-js-976a5ce00df899e95647.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-21fcf06c620ac7fe250f.js"],"component---src-pages-digest-js":["/component---src-pages-digest-js-cfbd5e27849c12548fdb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d833dc902a2207f245ed.js"]};/*]]>*/</script><script src="/webpack-runtime-8d99c0c389af96d474b0.js" async=""></script><script src="/styles-577ae45e6d2a94e7a3f3.js" async=""></script><script src="/app-23466d4bc1e9c7aa54ed.js" async=""></script><script src="/1-78f6aee68644394c4f8a.js" async=""></script><script src="/component---src-templates-blog-post-js-617c46b3566c32bb10ba.js" async=""></script></body></html>