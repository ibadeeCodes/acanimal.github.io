{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2012/09/17/creating-static-maps-in-openlayers-using-phantomjs/","webpackCompilationHash":"79efcce55e01ed481a07","result":{"data":{"markdownRemark":{"html":"<p>Many times in a web mapping application it is desired to save a picture with the current map information.Those who works with Google Maps API has also the &#x3C;a href=\"<a href=\"https://developers.google.com/maps/documentation/staticmaps/\">https://developers.google.com/maps/documentation/staticmaps/</a>\"</p>\n<blockquote>\n<p>Static Maps API</a>, which works similarly than Google Maps but produces static images.</p>\n</blockquote>\n<p>For example, next call:</p>\n<pre class=\"lang:default decode:true\">http://maps.googleapis.com/maps/api/staticmap?center=Brooklyn+Bridge,New+York,NY&amp;zoom=13&amp;size=600x300&amp;maptype=roadmap\n&amp;markers=color:blue%7Clabel:S%7C40.702147,-74.015794&amp;markers=color:green%7Clabel:G%7C40.711614,-74.012318\n&amp;markers=color:red%7Ccolor:red%7Clabel:C%7C40.718217,-73.998284&amp;sensor=false</pre>\n<p>produces the image:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACCElEQVQozw3O6XKaQAAAYN7/JTrTaX90NCqhHomxVlOVY1nkWGBZYC8Ojda0SVqNE0P7PcGnlDymiUcyptnHHrxcO+9t81iR/ka6xVqvciQ44jmquY+c6Rfjre88MpYQYnAeK5zhlCaSEQ3+UZ3Llf0+W7MdW0mZiMlAhDZnMU3DmpkG0D+bTUDIVgRh/oOGfaWgwUZizsKWdbyG5y5sdNjy3I7kGePxdsMYDbjM92I1B8kAPhe5W8psE0028UQxEF/69N6vu3bTg/9XFwiuAFAzb4TB10qgMrNkcBvBsQZfPVJXAtf4fov6ZcGUJdFW8UwFbhccevA8hDseTwtBd2SK5x9vFvHI2mrGoWWcWubZT/imxCUaF7nHGVL0VGtbT134V3VOqvPWMXczy6L+t/kSXOlP06VhowwlVA9KzXiMMd4yWIZ3hSCc+krX3ozArqc/qvCsri8qOExMb6SzL1aj2jXz2lv44Sfu03QN/DQlOHemLDYlw5XESgdcRs6vHngdrI/a+tJxGs3YXzunNmyAvRCJnuGVRJMi7HN3INyhbd0nCSpYVIpIUe2XDmyG3nkR1C3rMvP2fkTU1V5zTgKNq9yRHDMSErxI0+8Z0vfS5rlPE78qImUEt5r9cucehs7zEP5+kCgi4tMtdbF8wGOReTyPJY3yzOUiSLFnLieL+Y1jLWw4/Qc7k/FUUs3JEQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"staticmap\" title=\"staticmap\" src=\"/static/5c6905da9ced05657e71db71d19939ba/34e8a/staticmap.png\" srcset=\"/static/5c6905da9ced05657e71db71d19939ba/19bd1/staticmap.png 163w,\n/static/5c6905da9ced05657e71db71d19939ba/d3bcb/staticmap.png 325w,\n/static/5c6905da9ced05657e71db71d19939ba/34e8a/staticmap.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" loading=\"lazy\">\n    </span></p>\n<p>Unfortunately, using libraries other than Google Maps, like OpenLayers or Leaflet, there is no similar solution. Probably the best, simple and powerful one, is to install a plugin on your browser to take screenshots. But well.. I think that does not deserve to write a post :p</p>\n<h2>How to render a web page element to an image?</h2>\n<p>After writing my last post (<a title=\"Taking web page screenshots\" href=\"//2012/09/15/taking-web-page-screenshots\">Taking Web Page Screenshots</a>), where I show to to take a screenshot of a whole page, I was thinking on using PhantomJS to render only a portion of a page to an image.</p>\n<p>The PhantomJS&apos;s <code>WebPage</code> object has a <code>clipRect</code> property which determines the portion of the web page that must be rendered. With this in mind we can see a solution could be:</p>\n<ul>\n<li>Get the bounding rectangle of the desired DOM element to be rasterized.</li>\n<li>Set the <code>clipRect</code> property</li>\n<li>Render the page to a file.</li>\n</ul>\n<p>For that purpose I have prepared a little JavaScript application to run with PhantomJS. Its usage is as follows:</p>\n<pre class=\"prettyprint\">./bin/phantomjs ./examples/rasterize_element.js URL output_file selector</pre>\n<p>For example, the next execution against the demo of <a title=\"Animated marker cluster strategy for OpenLayers\" href=\"//2012/08/19/animated-marker-cluster-strategy-for-openlayers\">Animated Cluster Strategy for OpenLayers</a> selecting the first map:</p>\n<pre class=\"prettyprint\">./bin/phantomjs ./examples/rasterize_element.js http://www.acuriousanimal.com/AnimatedCluster map.png &apos;#map1&apos;</pre>\n<p>Produces the image:</p>\n<p><a href=\"./images/2012/09/map.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.23188405797102%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA+wAAAQ6wGnS/xvAAABvklEQVQozw2PW3PSUBSF+f9vfXVQR2udtnZaKaGl5aYNyKUhnJwQwjVcEggJCUUUXz/P25o9a639rUzTdvCCIet4SrjdILwhP0dtRqsp0u/w5OhovQGlkYkfWUy2NsvYZxXbpOmOMJmxSzz2qU+0XZBpuCZBPGGXevR9k9a4hzlXBbakKE00q02rrzGzqiTGew79K45+hTgZcQh10shgv4+I0jGTpUumNrRZ+S77ZMpSfU/ml+w3BmUp0UzBfc+haz1xyp/x9qJxqN9zHJwRRIJt2CZd67ytivwJisz8NpmiPcZyHzn4d4SbEeFa4vQ/UO6ZPFoGuX4TYRZIS1kS7SOb1xrBvMnv+QPhssFmt+BtU2br5XDH12QqjqOCkmBWIJ7dYLtFDPucguySF101u0M4fMYPWkwmr5wqXzn9uGHh1ZT+zGEk+ee8YA5eaYtLMtXBgFxXBR2XeeWOQM8ylVfo9RdypkPPuefUvOBUOufYUbp+q3y3PPU7ePYn7EaJ8HuWZyn4JqQqVISampcXgsovXZku+CuviSpfeBh0eBQGddFgbb5jL+rEhk5N1ilbgqps0lIQC0Vcnhrq3uI/+zvhbk8D2m4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"map\" title=\"map\" src=\"/static/1298dd89e4cf00985df32f8681b383b6/dbb61/map.png\" srcset=\"/static/1298dd89e4cf00985df32f8681b383b6/19bd1/map.png 163w,\n/static/1298dd89e4cf00985df32f8681b383b6/d3bcb/map.png 325w,\n/static/1298dd89e4cf00985df32f8681b383b6/dbb61/map.png 650w,\n/static/1298dd89e4cf00985df32f8681b383b6/7e0ae/map.png 828w\" sizes=\"(max-width: 650px) 100vw, 650px\" loading=\"lazy\">\n    </span></a></p>\n<p>Next is the whole code of the program (called <code>rasterize_element.js</code> and based on the <code>rasterize.js</code> application attached on the PhantomJS package):</p>\n<blockquote><p>Note: The code is accesible at <a href=\"https://gist.github.com/3732624\">GitHub:Gist</a>.</p></blockquote>\n<pre class=\"lang:js decode:true prettyprint \">var page = require(&apos;webpage&apos;).create(),\n    system = require(&apos;system&apos;),\n    address, output, size;</pre>\n<p>if (system.args.length &#x3C; 4 || system.args.length > 6) {\nconsole.log('Usage: rasterize_element.js URL filename selector [paperwidth*paperheight|paperformat] [zoom]');\nconsole.log('  paper (pdf output) examples: \"5in<em>7.5in\", \"10cm</em>20cm\", \"A4\", \"Letter\"');\nphantom.exit(1);\n} else {\naddress = system.args[1];\noutput = system.args[2];\nselector = system.args[3];\npage.viewportSize = { width: 600, height: 600 };\nif (system.args.length > 3 &#x26;&#x26; system.args[2].substr(-4) === \".pdf\") {\nsize = system.args[3].split('*');\npage.paperSize = size.length === 2 ? { width: size[0], height: size[1], margin: '0px' }\n: { format: system.args[3], orientation: 'portrait', margin: '1cm' };\n}\nif (system.args.length > 4) {\npage.zoomFactor = system.args[4];\n}\nconsole.log(\"Loading page...\");\npage.open(address, function (status) {\nif (status !== 'success') {\nconsole.log('Unable to load the address!');\n} else {\nwindow.setTimeout(function () {\nconsole.log(\"Getting element clipRect...\");\nvar clipRect = page.evaluate(function (s) {\nvar cr = document.querySelector(s).getBoundingClientRect();\nreturn cr;\n}, selector);</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">            page.clipRect = {\n                top:    clipRect.top,\n                left:   clipRect.left,\n                width:  clipRect.width,\n                height: clipRect.height\n            };\n            console.log(&quot;Rendering to file...&quot;);\n            page.render(output);\n            phantom.exit();\n        }, 200);\n    }\n});</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>}</pre></p>\n<h2>Alternatives and references</h2>\n<p>Of course I'm not the first one that has explore this issue. A nice <a href=\"https://gist.github.com/1501173\">snippet</a> from <a href=\"https://github.com/n1k0\">n1k0</a> can be found at <a href=\"https://gist.github.com/\">GitHub:Gist</a>. It does more or less the same as the code shown in this post.</p>\n<p>Another alternative is the use of <a href=\"http://casperjs.org/\">CasperJS</a>. As its home page says:</p>\n<blockquote><p>CasperJS is an open source <strong>navigation scripting &amp; testing utility</strong> written in Javascript and based on <a href=\"http://www.phantomjs.org/\">PhantomJS</a> — the scriptable headless <a href=\"http://www.webkit.org/\">WebKit</a> engine. It eases the process of <strong>defining a full navigation scenario</strong> and provides useful <strong>high-level functions, methods &amp; syntactic sugar</strong> for doing common tasks such as:</p>\n<ul>\n<li>defining &amp; ordering browsing <a href=\"http://casperjs.org/quickstart.html\">navigation steps</a></li>\n<li>filling &amp; submitting <a href=\"http://casperjs.org/api.html#casper.fill\">forms</a></li>\n<li><a href=\"http://casperjs.org/api.html#casper.click\">clicking</a> &amp; following links</li>\n<li><strong>capturing <a href=\"http://casperjs.org/api.html#casper.captureSelector\">screenshots</a> of a page (or part of it)</strong></li>\n<li><a href=\"http://casperjs.org/api.html#tester\">testing</a> remote DOM</li>\n<li><a href=\"http://casperjs.org/logging.html\">logging</a> events</li>\n<li><a href=\"http://casperjs.org/api.html#casper.download\">downloading</a> resources, including binary ones</li>\n<li>writing <a href=\"http://casperjs.org/testing.html\">functional test suites</a>, saving results as JUnit XML</li>\n<li><a href=\"https://github.com/n1k0/casperjs/blob/master/samples/\">scraping</a> Web contents</li>\n</ul>\n</blockquote>\n<p>With CasperJS capturing a page element is as easy as:</p>\n<pre class=\"prettyprint\">casper.start('http://www.weather.com/', function() {\n    this.captureSelector('weather.png', '.twc-story-block');\n});\ncasper.run();</pre>","excerpt":"Many times in a web mapping application it is desired to save a picture with the current map information.Those who works with Google Maps API has also the <a href=\"https://developers.google.com/maps/documentation/staticmaps/\" Static Maps API, which works similarly than Google Maps but produces static images. if (system.args.length < 4 || system.args.length > 6) {\n    console.log('Usage: rasterize_element.js URL filename selector paperwidth*paperheight|paperformat zoom');\n    console.log('  paper (pdf output) examples: \"5in7.5in\", \"10cm20cm\", \"A4\", \"Letter\"');\n    phantom.exit(1);\n} else {\n    address = system.args1;\n    output = system.args2;\n    selector = system.args3;\n    page.viewportSize = { width: 600, height: 600 };\n    if (system.args.length > 3 && system.args2.substr(-4) === \".pdf\") {\n        size = system.args3.split('*');\n        page.paperSize = size.length === 2 ? { width: size0, height: size1, margin: '0px' }\n                                           : { format: system.args3, orientation: 'portrait', margin: '1cm' };\n    }\n    if (system.args.length > 4) {\n        page.zoomFactor = system.args4;\n    }\n\tconsole.log(\"Loading page...\");\n    page.open(address, function (status) {\n        if (status !== 'success') {\n            console.log('Unable to load the address!');\n        } else {\n            window.setTimeout(function () {\n                console.log(\"Getting element clipRect...\");\n                var clipRect = page.evaluate(function (s) {\n\t                var cr = document.querySelector(s).getBoundingClientRect();\n\t                return cr;\n                }, selector); }","frontmatter":{"date":"17 September, 2012","title":"Creating static maps in OpenLayers using PhantomJS"},"fields":{"slug":"/blog/2012/09/17/creating-static-maps-in-openlayers-using-phantomjs/","readingTime":{"text":"4 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2012/09/17/creating-static-maps-in-openlayers-using-phantomjs/"}}}